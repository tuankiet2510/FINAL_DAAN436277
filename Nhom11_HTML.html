<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>0b67b3ca156141e696805703755ab63c</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="giới-thiệu" class="cell markdown">
<h1>GIỚI THIỆU</h1>
</section>
<section id="1-summary" class="cell markdown">
<h1>1. Summary</h1>
</section>
<section id="2-tải-và-khám-phá-tập-dữ-liệu" class="cell markdown">
<h1>2. Tải và khám phá tập dữ liệu</h1>
</section>
<section id="21-import-các-thư-viện-cần-thiết" class="cell markdown">
<h2>2.1. Import các thư viện cần thiết</h2>
</section>
<div class="cell code" data-execution_count="1">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> skew</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span></code></pre></div>
</div>
<section id="22-tải-dữ-liệu-từ-file-csv" class="cell markdown">
<h2>2.2. Tải dữ liệu từ file csv</h2>
<p>Nguồn dữ liệu <a
href="https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/data?select=train.csv"
class="uri">https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/data?select=train.csv</a></p>
</section>
<div class="cell code" data-execution_count="2">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="st">&#39;./house_input&#39;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> pd.read_csv(path<span class="op">+</span><span class="st">&#39;/train.csv&#39;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> pd.read_csv(path<span class="op">+</span><span class="st">&#39;/test.csv&#39;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">&quot;Data is loaded!&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Data is loaded!
</code></pre>
</div>
</div>
<section id="23-data-size-and-structure" class="cell markdown">
<h2>2.3. Data Size and Structure</h2>
</section>
<div class="cell code" data-execution_count="3">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">&quot;Train: &quot;</span>, df_train.shape[<span class="dv">0</span>], <span class="st">&quot;hàng, và &quot;</span>, df_train.shape[<span class="dv">1</span>], <span class="st">&quot;cột&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">&quot;Test: &quot;</span>, df_test.shape[<span class="dv">0</span>], <span class="st">&quot;hàng, và &quot;</span>, df_test.shape[<span class="dv">1</span>], <span class="st">&quot;cột&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Train:  1460 hàng, và  81 cột
Test:  1459 hàng, và  80 cột
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Tập dữ liệu train bao gồm 81 cột và 1460 hàng. Chúng ta có thể quan
sát 1 phần tập dữ liệu bằng cách in ra một số hàng đầu tiên:</p>
</div>
<section id="train" class="cell markdown">
<h3>Train</h3>
</section>
<div class="cell code" data-execution_count="4">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hiển thị 5 hàng đầu tiên của tập train</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df_train.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="4">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
      <th>SalePrice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>60</td>
      <td>RL</td>
      <td>65.0</td>
      <td>8450</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>208500</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>20</td>
      <td>RL</td>
      <td>80.0</td>
      <td>9600</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2007</td>
      <td>WD</td>
      <td>Normal</td>
      <td>181500</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>60</td>
      <td>RL</td>
      <td>68.0</td>
      <td>11250</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>9</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>223500</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>70</td>
      <td>RL</td>
      <td>60.0</td>
      <td>9550</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2006</td>
      <td>WD</td>
      <td>Abnorml</td>
      <td>140000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>60</td>
      <td>RL</td>
      <td>84.0</td>
      <td>14260</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>12</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>250000</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 81 columns</p>
</div>
</div>
</div>
<section id="test" class="cell markdown">
<h3>Test</h3>
</section>
<div class="cell code" data-execution_count="5">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hiển thị 5 hàng đầu tiên của tập test</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df_test.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="5">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1461</td>
      <td>20</td>
      <td>RH</td>
      <td>80.0</td>
      <td>11622</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>120</td>
      <td>0</td>
      <td>NaN</td>
      <td>MnPrv</td>
      <td>NaN</td>
      <td>0</td>
      <td>6</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1462</td>
      <td>20</td>
      <td>RL</td>
      <td>81.0</td>
      <td>14267</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Gar2</td>
      <td>12500</td>
      <td>6</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1463</td>
      <td>60</td>
      <td>RL</td>
      <td>74.0</td>
      <td>13830</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>MnPrv</td>
      <td>NaN</td>
      <td>0</td>
      <td>3</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1464</td>
      <td>60</td>
      <td>RL</td>
      <td>78.0</td>
      <td>9978</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>6</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1465</td>
      <td>120</td>
      <td>RL</td>
      <td>43.0</td>
      <td>5005</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>HLS</td>
      <td>AllPub</td>
      <td>...</td>
      <td>144</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>1</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 80 columns</p>
</div>
</div>
</div>
<div class="cell markdown">
<p>Loại bỏ cột <code>Id</code> vì nó không cần thiết cho việc huấn luyện
mô hình.</p>
</div>
<div class="cell code" data-execution_count="6">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lưu cột Id</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>train_ID <span class="op">=</span> df_train[<span class="st">&#39;Id&#39;</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>test_ID <span class="op">=</span> df_test[<span class="st">&#39;Id&#39;</span>]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Bỏ cột &#39;Id&#39; vì nó không cần thiết cho quá trình dự đoán.</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>df_train.drop(<span class="st">&quot;Id&quot;</span>, axis <span class="op">=</span> <span class="dv">1</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>df_test.drop(<span class="st">&quot;Id&quot;</span>, axis <span class="op">=</span> <span class="dv">1</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Kiểm tra lại kích thước dữ liệu sau khi loại bỏ cột &#39;Id&#39;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Kích thước tập train sau khi loại bỏ cột Id là : </span><span class="sc">{}</span><span class="st"> &quot;</span>.<span class="bu">format</span>(df_train.shape)) </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Kích thước tập train sau khi loại bỏ cột Id là : </span><span class="sc">{}</span><span class="st"> &quot;</span>.<span class="bu">format</span>(df_test.shape))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
Kích thước tập train sau khi loại bỏ cột Id là : (1460, 80) 
Kích thước tập train sau khi loại bỏ cột Id là : (1459, 79) 
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Có 79 thuộc tính. Bằng cách sử dụng những thuộc tính này, mô hình
phải đự đoán giá bán của căn nhà - được biểu thị bằng cột
<code>SalePrice</code>.</p>
</div>
<div class="cell markdown">
<p>Chúng ta có thể kiểm tra các thuộc tính đó như sau:</p>
</div>
<div class="cell code" data-execution_count="7">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_train.columns</span></code></pre></div>
<div class="output execute_result" data-execution_count="7">
<pre><code>Index([&#39;MSSubClass&#39;, &#39;MSZoning&#39;, &#39;LotFrontage&#39;, &#39;LotArea&#39;, &#39;Street&#39;, &#39;Alley&#39;,
       &#39;LotShape&#39;, &#39;LandContour&#39;, &#39;Utilities&#39;, &#39;LotConfig&#39;, &#39;LandSlope&#39;,
       &#39;Neighborhood&#39;, &#39;Condition1&#39;, &#39;Condition2&#39;, &#39;BldgType&#39;, &#39;HouseStyle&#39;,
       &#39;OverallQual&#39;, &#39;OverallCond&#39;, &#39;YearBuilt&#39;, &#39;YearRemodAdd&#39;, &#39;RoofStyle&#39;,
       &#39;RoofMatl&#39;, &#39;Exterior1st&#39;, &#39;Exterior2nd&#39;, &#39;MasVnrType&#39;, &#39;MasVnrArea&#39;,
       &#39;ExterQual&#39;, &#39;ExterCond&#39;, &#39;Foundation&#39;, &#39;BsmtQual&#39;, &#39;BsmtCond&#39;,
       &#39;BsmtExposure&#39;, &#39;BsmtFinType1&#39;, &#39;BsmtFinSF1&#39;, &#39;BsmtFinType2&#39;,
       &#39;BsmtFinSF2&#39;, &#39;BsmtUnfSF&#39;, &#39;TotalBsmtSF&#39;, &#39;Heating&#39;, &#39;HeatingQC&#39;,
       &#39;CentralAir&#39;, &#39;Electrical&#39;, &#39;1stFlrSF&#39;, &#39;2ndFlrSF&#39;, &#39;LowQualFinSF&#39;,
       &#39;GrLivArea&#39;, &#39;BsmtFullBath&#39;, &#39;BsmtHalfBath&#39;, &#39;FullBath&#39;, &#39;HalfBath&#39;,
       &#39;BedroomAbvGr&#39;, &#39;KitchenAbvGr&#39;, &#39;KitchenQual&#39;, &#39;TotRmsAbvGrd&#39;,
       &#39;Functional&#39;, &#39;Fireplaces&#39;, &#39;FireplaceQu&#39;, &#39;GarageType&#39;, &#39;GarageYrBlt&#39;,
       &#39;GarageFinish&#39;, &#39;GarageCars&#39;, &#39;GarageArea&#39;, &#39;GarageQual&#39;, &#39;GarageCond&#39;,
       &#39;PavedDrive&#39;, &#39;WoodDeckSF&#39;, &#39;OpenPorchSF&#39;, &#39;EnclosedPorch&#39;, &#39;3SsnPorch&#39;,
       &#39;ScreenPorch&#39;, &#39;PoolArea&#39;, &#39;PoolQC&#39;, &#39;Fence&#39;, &#39;MiscFeature&#39;, &#39;MiscVal&#39;,
       &#39;MoSold&#39;, &#39;YrSold&#39;, &#39;SaleType&#39;, &#39;SaleCondition&#39;, &#39;SalePrice&#39;],
      dtype=&#39;object&#39;)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="8">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_train.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1460 entries, 0 to 1459
Data columns (total 80 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   MSSubClass     1460 non-null   int64  
 1   MSZoning       1460 non-null   object 
 2   LotFrontage    1201 non-null   float64
 3   LotArea        1460 non-null   int64  
 4   Street         1460 non-null   object 
 5   Alley          91 non-null     object 
 6   LotShape       1460 non-null   object 
 7   LandContour    1460 non-null   object 
 8   Utilities      1460 non-null   object 
 9   LotConfig      1460 non-null   object 
 10  LandSlope      1460 non-null   object 
 11  Neighborhood   1460 non-null   object 
 12  Condition1     1460 non-null   object 
 13  Condition2     1460 non-null   object 
 14  BldgType       1460 non-null   object 
 15  HouseStyle     1460 non-null   object 
 16  OverallQual    1460 non-null   int64  
 17  OverallCond    1460 non-null   int64  
 18  YearBuilt      1460 non-null   int64  
 19  YearRemodAdd   1460 non-null   int64  
 20  RoofStyle      1460 non-null   object 
 21  RoofMatl       1460 non-null   object 
 22  Exterior1st    1460 non-null   object 
 23  Exterior2nd    1460 non-null   object 
 24  MasVnrType     1452 non-null   object 
 25  MasVnrArea     1452 non-null   float64
 26  ExterQual      1460 non-null   object 
 27  ExterCond      1460 non-null   object 
 28  Foundation     1460 non-null   object 
 29  BsmtQual       1423 non-null   object 
 30  BsmtCond       1423 non-null   object 
 31  BsmtExposure   1422 non-null   object 
 32  BsmtFinType1   1423 non-null   object 
 33  BsmtFinSF1     1460 non-null   int64  
 34  BsmtFinType2   1422 non-null   object 
 35  BsmtFinSF2     1460 non-null   int64  
 36  BsmtUnfSF      1460 non-null   int64  
 37  TotalBsmtSF    1460 non-null   int64  
 38  Heating        1460 non-null   object 
 39  HeatingQC      1460 non-null   object 
 40  CentralAir     1460 non-null   object 
 41  Electrical     1459 non-null   object 
 42  1stFlrSF       1460 non-null   int64  
 43  2ndFlrSF       1460 non-null   int64  
 44  LowQualFinSF   1460 non-null   int64  
 45  GrLivArea      1460 non-null   int64  
 46  BsmtFullBath   1460 non-null   int64  
 47  BsmtHalfBath   1460 non-null   int64  
 48  FullBath       1460 non-null   int64  
 49  HalfBath       1460 non-null   int64  
 50  BedroomAbvGr   1460 non-null   int64  
 51  KitchenAbvGr   1460 non-null   int64  
 52  KitchenQual    1460 non-null   object 
 53  TotRmsAbvGrd   1460 non-null   int64  
 54  Functional     1460 non-null   object 
 55  Fireplaces     1460 non-null   int64  
 56  FireplaceQu    770 non-null    object 
 57  GarageType     1379 non-null   object 
 58  GarageYrBlt    1379 non-null   float64
 59  GarageFinish   1379 non-null   object 
 60  GarageCars     1460 non-null   int64  
 61  GarageArea     1460 non-null   int64  
 62  GarageQual     1379 non-null   object 
 63  GarageCond     1379 non-null   object 
 64  PavedDrive     1460 non-null   object 
 65  WoodDeckSF     1460 non-null   int64  
 66  OpenPorchSF    1460 non-null   int64  
 67  EnclosedPorch  1460 non-null   int64  
 68  3SsnPorch      1460 non-null   int64  
 69  ScreenPorch    1460 non-null   int64  
 70  PoolArea       1460 non-null   int64  
 71  PoolQC         7 non-null      object 
 72  Fence          281 non-null    object 
 73  MiscFeature    54 non-null     object 
 74  MiscVal        1460 non-null   int64  
 75  MoSold         1460 non-null   int64  
 76  YrSold         1460 non-null   int64  
 77  SaleType       1460 non-null   object 
 78  SaleCondition  1460 non-null   object 
 79  SalePrice      1460 non-null   int64  
dtypes: float64(3), int64(34), object(43)
memory usage: 912.6+ KB
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="9">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>quantitative <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> df_train.columns <span class="cf">if</span> df_train.dtypes[f] <span class="op">!=</span> <span class="st">&#39;object&#39;</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>quantitative.remove(<span class="st">&#39;SalePrice&#39;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>qualitative <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> df_train.columns <span class="cf">if</span> df_train.dtypes[f] <span class="op">==</span> <span class="st">&#39;object&#39;</span>]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="10">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Định lượng</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>quantitative</span></code></pre></div>
<div class="output execute_result" data-execution_count="10">
<pre><code>[&#39;MSSubClass&#39;,
 &#39;LotFrontage&#39;,
 &#39;LotArea&#39;,
 &#39;OverallQual&#39;,
 &#39;OverallCond&#39;,
 &#39;YearBuilt&#39;,
 &#39;YearRemodAdd&#39;,
 &#39;MasVnrArea&#39;,
 &#39;BsmtFinSF1&#39;,
 &#39;BsmtFinSF2&#39;,
 &#39;BsmtUnfSF&#39;,
 &#39;TotalBsmtSF&#39;,
 &#39;1stFlrSF&#39;,
 &#39;2ndFlrSF&#39;,
 &#39;LowQualFinSF&#39;,
 &#39;GrLivArea&#39;,
 &#39;BsmtFullBath&#39;,
 &#39;BsmtHalfBath&#39;,
 &#39;FullBath&#39;,
 &#39;HalfBath&#39;,
 &#39;BedroomAbvGr&#39;,
 &#39;KitchenAbvGr&#39;,
 &#39;TotRmsAbvGrd&#39;,
 &#39;Fireplaces&#39;,
 &#39;GarageYrBlt&#39;,
 &#39;GarageCars&#39;,
 &#39;GarageArea&#39;,
 &#39;WoodDeckSF&#39;,
 &#39;OpenPorchSF&#39;,
 &#39;EnclosedPorch&#39;,
 &#39;3SsnPorch&#39;,
 &#39;ScreenPorch&#39;,
 &#39;PoolArea&#39;,
 &#39;MiscVal&#39;,
 &#39;MoSold&#39;,
 &#39;YrSold&#39;]</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="11">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Định tính</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>qualitative</span></code></pre></div>
<div class="output execute_result" data-execution_count="11">
<pre><code>[&#39;MSZoning&#39;,
 &#39;Street&#39;,
 &#39;Alley&#39;,
 &#39;LotShape&#39;,
 &#39;LandContour&#39;,
 &#39;Utilities&#39;,
 &#39;LotConfig&#39;,
 &#39;LandSlope&#39;,
 &#39;Neighborhood&#39;,
 &#39;Condition1&#39;,
 &#39;Condition2&#39;,
 &#39;BldgType&#39;,
 &#39;HouseStyle&#39;,
 &#39;RoofStyle&#39;,
 &#39;RoofMatl&#39;,
 &#39;Exterior1st&#39;,
 &#39;Exterior2nd&#39;,
 &#39;MasVnrType&#39;,
 &#39;ExterQual&#39;,
 &#39;ExterCond&#39;,
 &#39;Foundation&#39;,
 &#39;BsmtQual&#39;,
 &#39;BsmtCond&#39;,
 &#39;BsmtExposure&#39;,
 &#39;BsmtFinType1&#39;,
 &#39;BsmtFinType2&#39;,
 &#39;Heating&#39;,
 &#39;HeatingQC&#39;,
 &#39;CentralAir&#39;,
 &#39;Electrical&#39;,
 &#39;KitchenQual&#39;,
 &#39;Functional&#39;,
 &#39;FireplaceQu&#39;,
 &#39;GarageType&#39;,
 &#39;GarageFinish&#39;,
 &#39;GarageQual&#39;,
 &#39;GarageCond&#39;,
 &#39;PavedDrive&#39;,
 &#39;PoolQC&#39;,
 &#39;Fence&#39;,
 &#39;MiscFeature&#39;,
 &#39;SaleType&#39;,
 &#39;SaleCondition&#39;]</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Có 1460 trường dữ liệu train và 1459 trường dữ liệu test. Tổng số
thuộc tính là 80, trong đó có 36 thuộc tính định lượng, 43 thuộc tính
định tính (phân loại) và SalePrice.</p>
<ul>
<li><p>Định lượng(Quantitative): 1stFlrSF, 2ndFlrSF, 3SsnPorch,
BedroomAbvGr, BsmtFinSF1, BsmtFinSF2, BsmtFullBath, BsmtHalfBath,
BsmtUnfSF, EnclosedPorch, Fireplaces, FullBath, GarageArea, GarageCars,
GarageYrBlt, GrLivArea, HalfBath, KitchenAbvGr, LotArea, LotFrontage,
LowQualFinSF, MSSubClass, MasVnrArea, MiscVal, MoSold, OpenPorchSF,
OverallCond, OverallQual, PoolArea, ScreenPorch, TotRmsAbvGrd,
TotalBsmtSF, WoodDeckSF, YearBuilt, YearRemodAdd, YrSold</p></li>
<li><p>Định tính(Qualitative): Alley, BldgType, BsmtCond, BsmtExposure,
BsmtFinType1, BsmtFinType2, BsmtQual, CentralAir, Condition1,
Condition2, Electrical, ExterCond, ExterQual, Exterior1st, Exterior2nd,
Fence, FireplaceQu, Foundation, Functional, GarageCond, GarageFinish,
GarageQual, GarageType, Heating, HeatingQC, HouseStyle, KitchenQual,
LandContour, LandSlope, LotConfig, LotShape, MSZoning, MasVnrType,
MiscFeature, Neighborhood, PavedDrive, PoolQC, RoofMatl, RoofStyle,
SaleCondition, SaleType, Street, Utilities,</p></li>
</ul>
</div>
<section id="3-exploratory-data-analysis--phân-tích-khám-phá-dữ-liệu"
class="cell markdown">
<h1>3. Exploratory Data Analysis – Phân tích Khám phá Dữ liệu</h1>
</section>
<div class="cell markdown">
<p>Mục tiêu:</p>
<ul>
<li>Mỗi hàng trong tập dữ liệu mô tả các đặc điểm của một ngôi nhà.</li>
<li>Mục tiêu của chúng tôi là dự đoán Giá bán <code>SalePrice</code> dựa
trên các tính năng này.</li>
</ul>
</div>
<section id="31-biến-mục-tiêu-target-variable-saleprice"
class="cell markdown">
<h2>3.1. Biến mục tiêu (target variable): SalePrice</h2>
</section>
<div class="cell markdown">
<p>Đầu tiên, xem giá nhà được phân bố như thế nào:</p>
</div>
<div class="cell code" data-execution_count="12">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_train[<span class="st">&#39;SalePrice&#39;</span>].describe())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>count      1460.000000
mean     180921.195890
std       79442.502883
min       34900.000000
25%      129975.000000
50%      163000.000000
75%      214000.000000
max      755000.000000
Name: SalePrice, dtype: float64
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Giá nhà trung bình là 180921.195890 </br> Độ lệch chuẩn (căn bậc 2
phương sai) 79442.502883 cho thấy xung quanh giá trị trung bình có sự
dao động khá lớn </br></p>
</div>
<div class="cell code" data-execution_count="13">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;white&quot;</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sns.set_color_codes(palette<span class="op">=</span><span class="st">&#39;deep&#39;</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>f, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Kiểm tra phân phối </span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>sns.distplot(df_train[<span class="st">&#39;SalePrice&#39;</span>], color<span class="op">=</span><span class="st">&quot;b&quot;</span>)<span class="op">;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span>df_train[<span class="st">&#39;SalePrice&#39;</span>].mean(), color<span class="op">=</span><span class="st">&quot;r&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>)  <span class="co"># Vẽ đường dọc tại giá trị trung bình</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>ax.xaxis.grid(<span class="va">False</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">&quot;Frequency&quot;</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">&quot;SalePrice&quot;</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(title<span class="op">=</span><span class="st">&quot;Phân phối SalePrice&quot;</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>sns.despine(trim<span class="op">=</span><span class="va">True</span>, left<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/5637d960e85a05a20107a637ca9d03f44fbd1d11.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="14">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Skew và kurt</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Skewness: </span><span class="sc">%f</span><span class="st">&quot;</span> <span class="op">%</span> df_train[<span class="st">&#39;SalePrice&#39;</span>].skew())</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Kurtosis: </span><span class="sc">%f</span><span class="st">&quot;</span> <span class="op">%</span> df_train[<span class="st">&#39;SalePrice&#39;</span>].kurt())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Skewness: 1.882876
Kurtosis: 6.536282
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Một số ghi chú từ quan sát phân phối:</p>
<ul>
<li>Độ lệch khỏi phân phối chuẩn (normal distribution).</li>
<li>Có độ lệch chéo dương đáng kể (positive skewness).</li>
<li>Thể hiện đỉnh cao (show peakedness).</li>
</ul>
<p>Ta có thể thấy rằng giá bị lệch phải và một số giá trị ngoại lệ nằm
trên ~500.000. Vì các mô hình (tuyến tính) ưu tiên dữ liệu được phân
phối chuẩn, nên chúng ta cần chuyển đổi biến <code>SalePrice</code> này
và làm cho nó được phân phối chuẩn hơn.</p>
</div>
<section id="32-các-thuộc-tính-đầu-vào-features" class="cell markdown">
<h2>3.2. Các thuộc tính đầu vào (Features)</h2>
</section>
<div class="cell markdown">
<p>Ở phần này, ta sẽ xem xét sự phân bố giá trị của các thuộc tính đặc
trưng </br> Đầu tiên ta cần liệt kê các loại dữ liệu của các cột và tập
các thuộc tính loại số</p>
</div>
<div class="cell code" data-execution_count="15">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(<span class="bu">set</span>(df_train.dtypes.tolist()))</span></code></pre></div>
<div class="output execute_result" data-execution_count="15">
<pre><code>[dtype(&#39;O&#39;), dtype(&#39;int64&#39;), dtype(&#39;float64&#39;)]</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="16">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_num <span class="op">=</span> df_train.select_dtypes(include <span class="op">=</span> [<span class="st">&#39;float64&#39;</span>, <span class="st">&#39;int64&#39;</span>])</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_num.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="16">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MSSubClass</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>BsmtFinSF2</th>
      <th>...</th>
      <th>WoodDeckSF</th>
      <th>OpenPorchSF</th>
      <th>EnclosedPorch</th>
      <th>3SsnPorch</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SalePrice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>60</td>
      <td>65.0</td>
      <td>8450</td>
      <td>7</td>
      <td>5</td>
      <td>2003</td>
      <td>2003</td>
      <td>196.0</td>
      <td>706</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>61</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>2008</td>
      <td>208500</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20</td>
      <td>80.0</td>
      <td>9600</td>
      <td>6</td>
      <td>8</td>
      <td>1976</td>
      <td>1976</td>
      <td>0.0</td>
      <td>978</td>
      <td>0</td>
      <td>...</td>
      <td>298</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>2007</td>
      <td>181500</td>
    </tr>
    <tr>
      <th>2</th>
      <td>60</td>
      <td>68.0</td>
      <td>11250</td>
      <td>7</td>
      <td>5</td>
      <td>2001</td>
      <td>2002</td>
      <td>162.0</td>
      <td>486</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>42</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>2008</td>
      <td>223500</td>
    </tr>
    <tr>
      <th>3</th>
      <td>70</td>
      <td>60.0</td>
      <td>9550</td>
      <td>7</td>
      <td>5</td>
      <td>1915</td>
      <td>1970</td>
      <td>0.0</td>
      <td>216</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>35</td>
      <td>272</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>2006</td>
      <td>140000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>60</td>
      <td>84.0</td>
      <td>14260</td>
      <td>8</td>
      <td>5</td>
      <td>2000</td>
      <td>2000</td>
      <td>350.0</td>
      <td>655</td>
      <td>0</td>
      <td>...</td>
      <td>192</td>
      <td>84</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>12</td>
      <td>2008</td>
      <td>250000</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 37 columns</p>
</div>
</div>
</div>
<div class="cell markdown">
<p>Có 37 biến số (numeric variable). Ta sẽ vẽ biểu đồ phân phối giá trị
cho tất cả các biến số này</p>
</div>
<div class="cell code" data-execution_count="17">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">&quot;#bfd3e6&quot;</span>, <span class="st">&quot;#9b5b4f&quot;</span>, <span class="st">&quot;#4e4151&quot;</span>, <span class="st">&quot;#dbba78&quot;</span>, <span class="st">&quot;#bb9c55&quot;</span>, <span class="st">&quot;#909195&quot;</span>,<span class="st">&quot;#dc1e1e&quot;</span>,<span class="st">&quot;#a02933&quot;</span>,<span class="st">&quot;#716807&quot;</span>,<span class="st">&quot;#717cb4&quot;</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df_train.describe().T.style.bar(subset<span class="op">=</span>[<span class="st">&#39;mean&#39;</span>],color<span class="op">=</span>colors[<span class="dv">3</span>]).background_gradient(subset<span class="op">=</span>[<span class="st">&#39;std&#39;</span>,<span class="st">&#39;50%&#39;</span>,<span class="st">&#39;max&#39;</span>])</span></code></pre></div>
<div class="output execute_result" data-execution_count="17">
<style type="text/css">
#T_2927b_row0_col1, #T_2927b_row1_col1, #T_2927b_row3_col1, #T_2927b_row4_col1, #T_2927b_row9_col1, #T_2927b_row14_col1, #T_2927b_row16_col1, #T_2927b_row17_col1, #T_2927b_row18_col1, #T_2927b_row19_col1, #T_2927b_row20_col1, #T_2927b_row21_col1, #T_2927b_row22_col1, #T_2927b_row23_col1, #T_2927b_row25_col1, #T_2927b_row28_col1, #T_2927b_row29_col1, #T_2927b_row30_col1, #T_2927b_row31_col1, #T_2927b_row32_col1, #T_2927b_row33_col1, #T_2927b_row34_col1 {
  width: 10em;
  background: linear-gradient(90deg, #dbba78 0.0%, transparent 0.0%);
}
#T_2927b_row0_col2, #T_2927b_row0_col5, #T_2927b_row0_col7, #T_2927b_row1_col2, #T_2927b_row1_col5, #T_2927b_row1_col7, #T_2927b_row3_col2, #T_2927b_row3_col5, #T_2927b_row3_col7, #T_2927b_row4_col2, #T_2927b_row4_col5, #T_2927b_row4_col7, #T_2927b_row5_col2, #T_2927b_row5_col7, #T_2927b_row6_col2, #T_2927b_row6_col7, #T_2927b_row7_col2, #T_2927b_row7_col5, #T_2927b_row7_col7, #T_2927b_row8_col5, #T_2927b_row9_col2, #T_2927b_row9_col5, #T_2927b_row9_col7, #T_2927b_row10_col5, #T_2927b_row10_col7, #T_2927b_row13_col5, #T_2927b_row13_col7, #T_2927b_row14_col2, #T_2927b_row14_col5, #T_2927b_row14_col7, #T_2927b_row16_col2, #T_2927b_row16_col5, #T_2927b_row16_col7, #T_2927b_row17_col2, #T_2927b_row17_col5, #T_2927b_row17_col7, #T_2927b_row18_col2, #T_2927b_row18_col5, #T_2927b_row18_col7, #T_2927b_row19_col2, #T_2927b_row19_col5, #T_2927b_row19_col7, #T_2927b_row20_col2, #T_2927b_row20_col5, #T_2927b_row20_col7, #T_2927b_row21_col2, #T_2927b_row21_col5, #T_2927b_row21_col7, #T_2927b_row22_col2, #T_2927b_row22_col5, #T_2927b_row22_col7, #T_2927b_row23_col2, #T_2927b_row23_col5, #T_2927b_row23_col7, #T_2927b_row24_col2, #T_2927b_row24_col7, #T_2927b_row25_col2, #T_2927b_row25_col5, #T_2927b_row25_col7, #T_2927b_row26_col2, #T_2927b_row26_col5, #T_2927b_row26_col7, #T_2927b_row27_col2, #T_2927b_row27_col5, #T_2927b_row27_col7, #T_2927b_row28_col2, #T_2927b_row28_col5, #T_2927b_row28_col7, #T_2927b_row29_col2, #T_2927b_row29_col5, #T_2927b_row29_col7, #T_2927b_row30_col2, #T_2927b_row30_col5, #T_2927b_row30_col7, #T_2927b_row31_col2, #T_2927b_row31_col5, #T_2927b_row31_col7, #T_2927b_row32_col2, #T_2927b_row32_col5, #T_2927b_row32_col7, #T_2927b_row33_col5, #T_2927b_row34_col2, #T_2927b_row34_col5, #T_2927b_row34_col7, #T_2927b_row35_col2, #T_2927b_row35_col7 {
  background-color: #fff7fb;
  color: #000000;
}
#T_2927b_row2_col1 {
  width: 10em;
  background: linear-gradient(90deg, #dbba78 5.8%, transparent 5.8%);
}
#T_2927b_row2_col2 {
  background-color: #ece7f2;
  color: #000000;
}
#T_2927b_row2_col5 {
  background-color: #f7f0f7;
  color: #000000;
}
#T_2927b_row2_col7 {
  background-color: #c5cce3;
  color: #000000;
}
#T_2927b_row5_col1, #T_2927b_row6_col1, #T_2927b_row24_col1, #T_2927b_row35_col1 {
  width: 10em;
  background: linear-gradient(90deg, #dbba78 1.1%, transparent 1.1%);
}
#T_2927b_row5_col5, #T_2927b_row6_col5, #T_2927b_row24_col5, #T_2927b_row35_col5 {
  background-color: #fdf5fa;
  color: #000000;
}
#T_2927b_row7_col1, #T_2927b_row27_col1 {
  width: 10em;
  background: linear-gradient(90deg, #dbba78 0.1%, transparent 0.1%);
}
#T_2927b_row8_col1, #T_2927b_row13_col1 {
  width: 10em;
  background: linear-gradient(90deg, #dbba78 0.2%, transparent 0.2%);
}
#T_2927b_row8_col2, #T_2927b_row8_col7, #T_2927b_row10_col2, #T_2927b_row11_col2, #T_2927b_row11_col5, #T_2927b_row12_col2, #T_2927b_row12_col5, #T_2927b_row12_col7, #T_2927b_row13_col2, #T_2927b_row15_col2, #T_2927b_row15_col7, #T_2927b_row33_col2 {
  background-color: #fef6fb;
  color: #000000;
}
#T_2927b_row10_col1, #T_2927b_row26_col1 {
  width: 10em;
  background: linear-gradient(90deg, #dbba78 0.3%, transparent 0.3%);
}
#T_2927b_row11_col1, #T_2927b_row12_col1 {
  width: 10em;
  background: linear-gradient(90deg, #dbba78 0.6%, transparent 0.6%);
}
#T_2927b_row11_col7, #T_2927b_row15_col5 {
  background-color: #fef6fa;
  color: #000000;
}
#T_2927b_row15_col1 {
  width: 10em;
  background: linear-gradient(90deg, #dbba78 0.8%, transparent 0.8%);
}
#T_2927b_row33_col7 {
  background-color: #fcf4fa;
  color: #000000;
}
#T_2927b_row36_col1 {
  width: 10em;
  background: linear-gradient(90deg, #dbba78 100.0%, transparent 100.0%);
}
#T_2927b_row36_col2, #T_2927b_row36_col5, #T_2927b_row36_col7 {
  background-color: #023858;
  color: #f1f1f1;
}
</style>
<table id="T_2927b">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_2927b_level0_col0" class="col_heading level0 col0" >count</th>
      <th id="T_2927b_level0_col1" class="col_heading level0 col1" >mean</th>
      <th id="T_2927b_level0_col2" class="col_heading level0 col2" >std</th>
      <th id="T_2927b_level0_col3" class="col_heading level0 col3" >min</th>
      <th id="T_2927b_level0_col4" class="col_heading level0 col4" >25%</th>
      <th id="T_2927b_level0_col5" class="col_heading level0 col5" >50%</th>
      <th id="T_2927b_level0_col6" class="col_heading level0 col6" >75%</th>
      <th id="T_2927b_level0_col7" class="col_heading level0 col7" >max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_2927b_level0_row0" class="row_heading level0 row0" >MSSubClass</th>
      <td id="T_2927b_row0_col0" class="data row0 col0" >1460.000000</td>
      <td id="T_2927b_row0_col1" class="data row0 col1" >56.897260</td>
      <td id="T_2927b_row0_col2" class="data row0 col2" >42.300571</td>
      <td id="T_2927b_row0_col3" class="data row0 col3" >20.000000</td>
      <td id="T_2927b_row0_col4" class="data row0 col4" >20.000000</td>
      <td id="T_2927b_row0_col5" class="data row0 col5" >50.000000</td>
      <td id="T_2927b_row0_col6" class="data row0 col6" >70.000000</td>
      <td id="T_2927b_row0_col7" class="data row0 col7" >190.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row1" class="row_heading level0 row1" >LotFrontage</th>
      <td id="T_2927b_row1_col0" class="data row1 col0" >1201.000000</td>
      <td id="T_2927b_row1_col1" class="data row1 col1" >70.049958</td>
      <td id="T_2927b_row1_col2" class="data row1 col2" >24.284752</td>
      <td id="T_2927b_row1_col3" class="data row1 col3" >21.000000</td>
      <td id="T_2927b_row1_col4" class="data row1 col4" >59.000000</td>
      <td id="T_2927b_row1_col5" class="data row1 col5" >69.000000</td>
      <td id="T_2927b_row1_col6" class="data row1 col6" >80.000000</td>
      <td id="T_2927b_row1_col7" class="data row1 col7" >313.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row2" class="row_heading level0 row2" >LotArea</th>
      <td id="T_2927b_row2_col0" class="data row2 col0" >1460.000000</td>
      <td id="T_2927b_row2_col1" class="data row2 col1" >10516.828082</td>
      <td id="T_2927b_row2_col2" class="data row2 col2" >9981.264932</td>
      <td id="T_2927b_row2_col3" class="data row2 col3" >1300.000000</td>
      <td id="T_2927b_row2_col4" class="data row2 col4" >7553.500000</td>
      <td id="T_2927b_row2_col5" class="data row2 col5" >9478.500000</td>
      <td id="T_2927b_row2_col6" class="data row2 col6" >11601.500000</td>
      <td id="T_2927b_row2_col7" class="data row2 col7" >215245.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row3" class="row_heading level0 row3" >OverallQual</th>
      <td id="T_2927b_row3_col0" class="data row3 col0" >1460.000000</td>
      <td id="T_2927b_row3_col1" class="data row3 col1" >6.099315</td>
      <td id="T_2927b_row3_col2" class="data row3 col2" >1.382997</td>
      <td id="T_2927b_row3_col3" class="data row3 col3" >1.000000</td>
      <td id="T_2927b_row3_col4" class="data row3 col4" >5.000000</td>
      <td id="T_2927b_row3_col5" class="data row3 col5" >6.000000</td>
      <td id="T_2927b_row3_col6" class="data row3 col6" >7.000000</td>
      <td id="T_2927b_row3_col7" class="data row3 col7" >10.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row4" class="row_heading level0 row4" >OverallCond</th>
      <td id="T_2927b_row4_col0" class="data row4 col0" >1460.000000</td>
      <td id="T_2927b_row4_col1" class="data row4 col1" >5.575342</td>
      <td id="T_2927b_row4_col2" class="data row4 col2" >1.112799</td>
      <td id="T_2927b_row4_col3" class="data row4 col3" >1.000000</td>
      <td id="T_2927b_row4_col4" class="data row4 col4" >5.000000</td>
      <td id="T_2927b_row4_col5" class="data row4 col5" >5.000000</td>
      <td id="T_2927b_row4_col6" class="data row4 col6" >6.000000</td>
      <td id="T_2927b_row4_col7" class="data row4 col7" >9.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row5" class="row_heading level0 row5" >YearBuilt</th>
      <td id="T_2927b_row5_col0" class="data row5 col0" >1460.000000</td>
      <td id="T_2927b_row5_col1" class="data row5 col1" >1971.267808</td>
      <td id="T_2927b_row5_col2" class="data row5 col2" >30.202904</td>
      <td id="T_2927b_row5_col3" class="data row5 col3" >1872.000000</td>
      <td id="T_2927b_row5_col4" class="data row5 col4" >1954.000000</td>
      <td id="T_2927b_row5_col5" class="data row5 col5" >1973.000000</td>
      <td id="T_2927b_row5_col6" class="data row5 col6" >2000.000000</td>
      <td id="T_2927b_row5_col7" class="data row5 col7" >2010.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row6" class="row_heading level0 row6" >YearRemodAdd</th>
      <td id="T_2927b_row6_col0" class="data row6 col0" >1460.000000</td>
      <td id="T_2927b_row6_col1" class="data row6 col1" >1984.865753</td>
      <td id="T_2927b_row6_col2" class="data row6 col2" >20.645407</td>
      <td id="T_2927b_row6_col3" class="data row6 col3" >1950.000000</td>
      <td id="T_2927b_row6_col4" class="data row6 col4" >1967.000000</td>
      <td id="T_2927b_row6_col5" class="data row6 col5" >1994.000000</td>
      <td id="T_2927b_row6_col6" class="data row6 col6" >2004.000000</td>
      <td id="T_2927b_row6_col7" class="data row6 col7" >2010.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row7" class="row_heading level0 row7" >MasVnrArea</th>
      <td id="T_2927b_row7_col0" class="data row7 col0" >1452.000000</td>
      <td id="T_2927b_row7_col1" class="data row7 col1" >103.685262</td>
      <td id="T_2927b_row7_col2" class="data row7 col2" >181.066207</td>
      <td id="T_2927b_row7_col3" class="data row7 col3" >0.000000</td>
      <td id="T_2927b_row7_col4" class="data row7 col4" >0.000000</td>
      <td id="T_2927b_row7_col5" class="data row7 col5" >0.000000</td>
      <td id="T_2927b_row7_col6" class="data row7 col6" >166.000000</td>
      <td id="T_2927b_row7_col7" class="data row7 col7" >1600.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row8" class="row_heading level0 row8" >BsmtFinSF1</th>
      <td id="T_2927b_row8_col0" class="data row8 col0" >1460.000000</td>
      <td id="T_2927b_row8_col1" class="data row8 col1" >443.639726</td>
      <td id="T_2927b_row8_col2" class="data row8 col2" >456.098091</td>
      <td id="T_2927b_row8_col3" class="data row8 col3" >0.000000</td>
      <td id="T_2927b_row8_col4" class="data row8 col4" >0.000000</td>
      <td id="T_2927b_row8_col5" class="data row8 col5" >383.500000</td>
      <td id="T_2927b_row8_col6" class="data row8 col6" >712.250000</td>
      <td id="T_2927b_row8_col7" class="data row8 col7" >5644.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row9" class="row_heading level0 row9" >BsmtFinSF2</th>
      <td id="T_2927b_row9_col0" class="data row9 col0" >1460.000000</td>
      <td id="T_2927b_row9_col1" class="data row9 col1" >46.549315</td>
      <td id="T_2927b_row9_col2" class="data row9 col2" >161.319273</td>
      <td id="T_2927b_row9_col3" class="data row9 col3" >0.000000</td>
      <td id="T_2927b_row9_col4" class="data row9 col4" >0.000000</td>
      <td id="T_2927b_row9_col5" class="data row9 col5" >0.000000</td>
      <td id="T_2927b_row9_col6" class="data row9 col6" >0.000000</td>
      <td id="T_2927b_row9_col7" class="data row9 col7" >1474.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row10" class="row_heading level0 row10" >BsmtUnfSF</th>
      <td id="T_2927b_row10_col0" class="data row10 col0" >1460.000000</td>
      <td id="T_2927b_row10_col1" class="data row10 col1" >567.240411</td>
      <td id="T_2927b_row10_col2" class="data row10 col2" >441.866955</td>
      <td id="T_2927b_row10_col3" class="data row10 col3" >0.000000</td>
      <td id="T_2927b_row10_col4" class="data row10 col4" >223.000000</td>
      <td id="T_2927b_row10_col5" class="data row10 col5" >477.500000</td>
      <td id="T_2927b_row10_col6" class="data row10 col6" >808.000000</td>
      <td id="T_2927b_row10_col7" class="data row10 col7" >2336.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row11" class="row_heading level0 row11" >TotalBsmtSF</th>
      <td id="T_2927b_row11_col0" class="data row11 col0" >1460.000000</td>
      <td id="T_2927b_row11_col1" class="data row11 col1" >1057.429452</td>
      <td id="T_2927b_row11_col2" class="data row11 col2" >438.705324</td>
      <td id="T_2927b_row11_col3" class="data row11 col3" >0.000000</td>
      <td id="T_2927b_row11_col4" class="data row11 col4" >795.750000</td>
      <td id="T_2927b_row11_col5" class="data row11 col5" >991.500000</td>
      <td id="T_2927b_row11_col6" class="data row11 col6" >1298.250000</td>
      <td id="T_2927b_row11_col7" class="data row11 col7" >6110.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row12" class="row_heading level0 row12" >1stFlrSF</th>
      <td id="T_2927b_row12_col0" class="data row12 col0" >1460.000000</td>
      <td id="T_2927b_row12_col1" class="data row12 col1" >1162.626712</td>
      <td id="T_2927b_row12_col2" class="data row12 col2" >386.587738</td>
      <td id="T_2927b_row12_col3" class="data row12 col3" >334.000000</td>
      <td id="T_2927b_row12_col4" class="data row12 col4" >882.000000</td>
      <td id="T_2927b_row12_col5" class="data row12 col5" >1087.000000</td>
      <td id="T_2927b_row12_col6" class="data row12 col6" >1391.250000</td>
      <td id="T_2927b_row12_col7" class="data row12 col7" >4692.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row13" class="row_heading level0 row13" >2ndFlrSF</th>
      <td id="T_2927b_row13_col0" class="data row13 col0" >1460.000000</td>
      <td id="T_2927b_row13_col1" class="data row13 col1" >346.992466</td>
      <td id="T_2927b_row13_col2" class="data row13 col2" >436.528436</td>
      <td id="T_2927b_row13_col3" class="data row13 col3" >0.000000</td>
      <td id="T_2927b_row13_col4" class="data row13 col4" >0.000000</td>
      <td id="T_2927b_row13_col5" class="data row13 col5" >0.000000</td>
      <td id="T_2927b_row13_col6" class="data row13 col6" >728.000000</td>
      <td id="T_2927b_row13_col7" class="data row13 col7" >2065.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row14" class="row_heading level0 row14" >LowQualFinSF</th>
      <td id="T_2927b_row14_col0" class="data row14 col0" >1460.000000</td>
      <td id="T_2927b_row14_col1" class="data row14 col1" >5.844521</td>
      <td id="T_2927b_row14_col2" class="data row14 col2" >48.623081</td>
      <td id="T_2927b_row14_col3" class="data row14 col3" >0.000000</td>
      <td id="T_2927b_row14_col4" class="data row14 col4" >0.000000</td>
      <td id="T_2927b_row14_col5" class="data row14 col5" >0.000000</td>
      <td id="T_2927b_row14_col6" class="data row14 col6" >0.000000</td>
      <td id="T_2927b_row14_col7" class="data row14 col7" >572.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row15" class="row_heading level0 row15" >GrLivArea</th>
      <td id="T_2927b_row15_col0" class="data row15 col0" >1460.000000</td>
      <td id="T_2927b_row15_col1" class="data row15 col1" >1515.463699</td>
      <td id="T_2927b_row15_col2" class="data row15 col2" >525.480383</td>
      <td id="T_2927b_row15_col3" class="data row15 col3" >334.000000</td>
      <td id="T_2927b_row15_col4" class="data row15 col4" >1129.500000</td>
      <td id="T_2927b_row15_col5" class="data row15 col5" >1464.000000</td>
      <td id="T_2927b_row15_col6" class="data row15 col6" >1776.750000</td>
      <td id="T_2927b_row15_col7" class="data row15 col7" >5642.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row16" class="row_heading level0 row16" >BsmtFullBath</th>
      <td id="T_2927b_row16_col0" class="data row16 col0" >1460.000000</td>
      <td id="T_2927b_row16_col1" class="data row16 col1" >0.425342</td>
      <td id="T_2927b_row16_col2" class="data row16 col2" >0.518911</td>
      <td id="T_2927b_row16_col3" class="data row16 col3" >0.000000</td>
      <td id="T_2927b_row16_col4" class="data row16 col4" >0.000000</td>
      <td id="T_2927b_row16_col5" class="data row16 col5" >0.000000</td>
      <td id="T_2927b_row16_col6" class="data row16 col6" >1.000000</td>
      <td id="T_2927b_row16_col7" class="data row16 col7" >3.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row17" class="row_heading level0 row17" >BsmtHalfBath</th>
      <td id="T_2927b_row17_col0" class="data row17 col0" >1460.000000</td>
      <td id="T_2927b_row17_col1" class="data row17 col1" >0.057534</td>
      <td id="T_2927b_row17_col2" class="data row17 col2" >0.238753</td>
      <td id="T_2927b_row17_col3" class="data row17 col3" >0.000000</td>
      <td id="T_2927b_row17_col4" class="data row17 col4" >0.000000</td>
      <td id="T_2927b_row17_col5" class="data row17 col5" >0.000000</td>
      <td id="T_2927b_row17_col6" class="data row17 col6" >0.000000</td>
      <td id="T_2927b_row17_col7" class="data row17 col7" >2.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row18" class="row_heading level0 row18" >FullBath</th>
      <td id="T_2927b_row18_col0" class="data row18 col0" >1460.000000</td>
      <td id="T_2927b_row18_col1" class="data row18 col1" >1.565068</td>
      <td id="T_2927b_row18_col2" class="data row18 col2" >0.550916</td>
      <td id="T_2927b_row18_col3" class="data row18 col3" >0.000000</td>
      <td id="T_2927b_row18_col4" class="data row18 col4" >1.000000</td>
      <td id="T_2927b_row18_col5" class="data row18 col5" >2.000000</td>
      <td id="T_2927b_row18_col6" class="data row18 col6" >2.000000</td>
      <td id="T_2927b_row18_col7" class="data row18 col7" >3.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row19" class="row_heading level0 row19" >HalfBath</th>
      <td id="T_2927b_row19_col0" class="data row19 col0" >1460.000000</td>
      <td id="T_2927b_row19_col1" class="data row19 col1" >0.382877</td>
      <td id="T_2927b_row19_col2" class="data row19 col2" >0.502885</td>
      <td id="T_2927b_row19_col3" class="data row19 col3" >0.000000</td>
      <td id="T_2927b_row19_col4" class="data row19 col4" >0.000000</td>
      <td id="T_2927b_row19_col5" class="data row19 col5" >0.000000</td>
      <td id="T_2927b_row19_col6" class="data row19 col6" >1.000000</td>
      <td id="T_2927b_row19_col7" class="data row19 col7" >2.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row20" class="row_heading level0 row20" >BedroomAbvGr</th>
      <td id="T_2927b_row20_col0" class="data row20 col0" >1460.000000</td>
      <td id="T_2927b_row20_col1" class="data row20 col1" >2.866438</td>
      <td id="T_2927b_row20_col2" class="data row20 col2" >0.815778</td>
      <td id="T_2927b_row20_col3" class="data row20 col3" >0.000000</td>
      <td id="T_2927b_row20_col4" class="data row20 col4" >2.000000</td>
      <td id="T_2927b_row20_col5" class="data row20 col5" >3.000000</td>
      <td id="T_2927b_row20_col6" class="data row20 col6" >3.000000</td>
      <td id="T_2927b_row20_col7" class="data row20 col7" >8.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row21" class="row_heading level0 row21" >KitchenAbvGr</th>
      <td id="T_2927b_row21_col0" class="data row21 col0" >1460.000000</td>
      <td id="T_2927b_row21_col1" class="data row21 col1" >1.046575</td>
      <td id="T_2927b_row21_col2" class="data row21 col2" >0.220338</td>
      <td id="T_2927b_row21_col3" class="data row21 col3" >0.000000</td>
      <td id="T_2927b_row21_col4" class="data row21 col4" >1.000000</td>
      <td id="T_2927b_row21_col5" class="data row21 col5" >1.000000</td>
      <td id="T_2927b_row21_col6" class="data row21 col6" >1.000000</td>
      <td id="T_2927b_row21_col7" class="data row21 col7" >3.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row22" class="row_heading level0 row22" >TotRmsAbvGrd</th>
      <td id="T_2927b_row22_col0" class="data row22 col0" >1460.000000</td>
      <td id="T_2927b_row22_col1" class="data row22 col1" >6.517808</td>
      <td id="T_2927b_row22_col2" class="data row22 col2" >1.625393</td>
      <td id="T_2927b_row22_col3" class="data row22 col3" >2.000000</td>
      <td id="T_2927b_row22_col4" class="data row22 col4" >5.000000</td>
      <td id="T_2927b_row22_col5" class="data row22 col5" >6.000000</td>
      <td id="T_2927b_row22_col6" class="data row22 col6" >7.000000</td>
      <td id="T_2927b_row22_col7" class="data row22 col7" >14.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row23" class="row_heading level0 row23" >Fireplaces</th>
      <td id="T_2927b_row23_col0" class="data row23 col0" >1460.000000</td>
      <td id="T_2927b_row23_col1" class="data row23 col1" >0.613014</td>
      <td id="T_2927b_row23_col2" class="data row23 col2" >0.644666</td>
      <td id="T_2927b_row23_col3" class="data row23 col3" >0.000000</td>
      <td id="T_2927b_row23_col4" class="data row23 col4" >0.000000</td>
      <td id="T_2927b_row23_col5" class="data row23 col5" >1.000000</td>
      <td id="T_2927b_row23_col6" class="data row23 col6" >1.000000</td>
      <td id="T_2927b_row23_col7" class="data row23 col7" >3.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row24" class="row_heading level0 row24" >GarageYrBlt</th>
      <td id="T_2927b_row24_col0" class="data row24 col0" >1379.000000</td>
      <td id="T_2927b_row24_col1" class="data row24 col1" >1978.506164</td>
      <td id="T_2927b_row24_col2" class="data row24 col2" >24.689725</td>
      <td id="T_2927b_row24_col3" class="data row24 col3" >1900.000000</td>
      <td id="T_2927b_row24_col4" class="data row24 col4" >1961.000000</td>
      <td id="T_2927b_row24_col5" class="data row24 col5" >1980.000000</td>
      <td id="T_2927b_row24_col6" class="data row24 col6" >2002.000000</td>
      <td id="T_2927b_row24_col7" class="data row24 col7" >2010.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row25" class="row_heading level0 row25" >GarageCars</th>
      <td id="T_2927b_row25_col0" class="data row25 col0" >1460.000000</td>
      <td id="T_2927b_row25_col1" class="data row25 col1" >1.767123</td>
      <td id="T_2927b_row25_col2" class="data row25 col2" >0.747315</td>
      <td id="T_2927b_row25_col3" class="data row25 col3" >0.000000</td>
      <td id="T_2927b_row25_col4" class="data row25 col4" >1.000000</td>
      <td id="T_2927b_row25_col5" class="data row25 col5" >2.000000</td>
      <td id="T_2927b_row25_col6" class="data row25 col6" >2.000000</td>
      <td id="T_2927b_row25_col7" class="data row25 col7" >4.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row26" class="row_heading level0 row26" >GarageArea</th>
      <td id="T_2927b_row26_col0" class="data row26 col0" >1460.000000</td>
      <td id="T_2927b_row26_col1" class="data row26 col1" >472.980137</td>
      <td id="T_2927b_row26_col2" class="data row26 col2" >213.804841</td>
      <td id="T_2927b_row26_col3" class="data row26 col3" >0.000000</td>
      <td id="T_2927b_row26_col4" class="data row26 col4" >334.500000</td>
      <td id="T_2927b_row26_col5" class="data row26 col5" >480.000000</td>
      <td id="T_2927b_row26_col6" class="data row26 col6" >576.000000</td>
      <td id="T_2927b_row26_col7" class="data row26 col7" >1418.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row27" class="row_heading level0 row27" >WoodDeckSF</th>
      <td id="T_2927b_row27_col0" class="data row27 col0" >1460.000000</td>
      <td id="T_2927b_row27_col1" class="data row27 col1" >94.244521</td>
      <td id="T_2927b_row27_col2" class="data row27 col2" >125.338794</td>
      <td id="T_2927b_row27_col3" class="data row27 col3" >0.000000</td>
      <td id="T_2927b_row27_col4" class="data row27 col4" >0.000000</td>
      <td id="T_2927b_row27_col5" class="data row27 col5" >0.000000</td>
      <td id="T_2927b_row27_col6" class="data row27 col6" >168.000000</td>
      <td id="T_2927b_row27_col7" class="data row27 col7" >857.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row28" class="row_heading level0 row28" >OpenPorchSF</th>
      <td id="T_2927b_row28_col0" class="data row28 col0" >1460.000000</td>
      <td id="T_2927b_row28_col1" class="data row28 col1" >46.660274</td>
      <td id="T_2927b_row28_col2" class="data row28 col2" >66.256028</td>
      <td id="T_2927b_row28_col3" class="data row28 col3" >0.000000</td>
      <td id="T_2927b_row28_col4" class="data row28 col4" >0.000000</td>
      <td id="T_2927b_row28_col5" class="data row28 col5" >25.000000</td>
      <td id="T_2927b_row28_col6" class="data row28 col6" >68.000000</td>
      <td id="T_2927b_row28_col7" class="data row28 col7" >547.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row29" class="row_heading level0 row29" >EnclosedPorch</th>
      <td id="T_2927b_row29_col0" class="data row29 col0" >1460.000000</td>
      <td id="T_2927b_row29_col1" class="data row29 col1" >21.954110</td>
      <td id="T_2927b_row29_col2" class="data row29 col2" >61.119149</td>
      <td id="T_2927b_row29_col3" class="data row29 col3" >0.000000</td>
      <td id="T_2927b_row29_col4" class="data row29 col4" >0.000000</td>
      <td id="T_2927b_row29_col5" class="data row29 col5" >0.000000</td>
      <td id="T_2927b_row29_col6" class="data row29 col6" >0.000000</td>
      <td id="T_2927b_row29_col7" class="data row29 col7" >552.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row30" class="row_heading level0 row30" >3SsnPorch</th>
      <td id="T_2927b_row30_col0" class="data row30 col0" >1460.000000</td>
      <td id="T_2927b_row30_col1" class="data row30 col1" >3.409589</td>
      <td id="T_2927b_row30_col2" class="data row30 col2" >29.317331</td>
      <td id="T_2927b_row30_col3" class="data row30 col3" >0.000000</td>
      <td id="T_2927b_row30_col4" class="data row30 col4" >0.000000</td>
      <td id="T_2927b_row30_col5" class="data row30 col5" >0.000000</td>
      <td id="T_2927b_row30_col6" class="data row30 col6" >0.000000</td>
      <td id="T_2927b_row30_col7" class="data row30 col7" >508.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row31" class="row_heading level0 row31" >ScreenPorch</th>
      <td id="T_2927b_row31_col0" class="data row31 col0" >1460.000000</td>
      <td id="T_2927b_row31_col1" class="data row31 col1" >15.060959</td>
      <td id="T_2927b_row31_col2" class="data row31 col2" >55.757415</td>
      <td id="T_2927b_row31_col3" class="data row31 col3" >0.000000</td>
      <td id="T_2927b_row31_col4" class="data row31 col4" >0.000000</td>
      <td id="T_2927b_row31_col5" class="data row31 col5" >0.000000</td>
      <td id="T_2927b_row31_col6" class="data row31 col6" >0.000000</td>
      <td id="T_2927b_row31_col7" class="data row31 col7" >480.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row32" class="row_heading level0 row32" >PoolArea</th>
      <td id="T_2927b_row32_col0" class="data row32 col0" >1460.000000</td>
      <td id="T_2927b_row32_col1" class="data row32 col1" >2.758904</td>
      <td id="T_2927b_row32_col2" class="data row32 col2" >40.177307</td>
      <td id="T_2927b_row32_col3" class="data row32 col3" >0.000000</td>
      <td id="T_2927b_row32_col4" class="data row32 col4" >0.000000</td>
      <td id="T_2927b_row32_col5" class="data row32 col5" >0.000000</td>
      <td id="T_2927b_row32_col6" class="data row32 col6" >0.000000</td>
      <td id="T_2927b_row32_col7" class="data row32 col7" >738.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row33" class="row_heading level0 row33" >MiscVal</th>
      <td id="T_2927b_row33_col0" class="data row33 col0" >1460.000000</td>
      <td id="T_2927b_row33_col1" class="data row33 col1" >43.489041</td>
      <td id="T_2927b_row33_col2" class="data row33 col2" >496.123024</td>
      <td id="T_2927b_row33_col3" class="data row33 col3" >0.000000</td>
      <td id="T_2927b_row33_col4" class="data row33 col4" >0.000000</td>
      <td id="T_2927b_row33_col5" class="data row33 col5" >0.000000</td>
      <td id="T_2927b_row33_col6" class="data row33 col6" >0.000000</td>
      <td id="T_2927b_row33_col7" class="data row33 col7" >15500.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row34" class="row_heading level0 row34" >MoSold</th>
      <td id="T_2927b_row34_col0" class="data row34 col0" >1460.000000</td>
      <td id="T_2927b_row34_col1" class="data row34 col1" >6.321918</td>
      <td id="T_2927b_row34_col2" class="data row34 col2" >2.703626</td>
      <td id="T_2927b_row34_col3" class="data row34 col3" >1.000000</td>
      <td id="T_2927b_row34_col4" class="data row34 col4" >5.000000</td>
      <td id="T_2927b_row34_col5" class="data row34 col5" >6.000000</td>
      <td id="T_2927b_row34_col6" class="data row34 col6" >8.000000</td>
      <td id="T_2927b_row34_col7" class="data row34 col7" >12.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row35" class="row_heading level0 row35" >YrSold</th>
      <td id="T_2927b_row35_col0" class="data row35 col0" >1460.000000</td>
      <td id="T_2927b_row35_col1" class="data row35 col1" >2007.815753</td>
      <td id="T_2927b_row35_col2" class="data row35 col2" >1.328095</td>
      <td id="T_2927b_row35_col3" class="data row35 col3" >2006.000000</td>
      <td id="T_2927b_row35_col4" class="data row35 col4" >2007.000000</td>
      <td id="T_2927b_row35_col5" class="data row35 col5" >2008.000000</td>
      <td id="T_2927b_row35_col6" class="data row35 col6" >2009.000000</td>
      <td id="T_2927b_row35_col7" class="data row35 col7" >2010.000000</td>
    </tr>
    <tr>
      <th id="T_2927b_level0_row36" class="row_heading level0 row36" >SalePrice</th>
      <td id="T_2927b_row36_col0" class="data row36 col0" >1460.000000</td>
      <td id="T_2927b_row36_col1" class="data row36 col1" >180921.195890</td>
      <td id="T_2927b_row36_col2" class="data row36 col2" >79442.502883</td>
      <td id="T_2927b_row36_col3" class="data row36 col3" >34900.000000</td>
      <td id="T_2927b_row36_col4" class="data row36 col4" >129975.000000</td>
      <td id="T_2927b_row36_col5" class="data row36 col5" >163000.000000</td>
      <td id="T_2927b_row36_col6" class="data row36 col6" >214000.000000</td>
      <td id="T_2927b_row36_col7" class="data row36 col7" >755000.000000</td>
    </tr>
  </tbody>
</table>

</div>
</div>
<div class="cell code" data-execution_count="18">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df_num.hist(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">20</span>), bins<span class="op">=</span><span class="dv">50</span>, xlabelsize<span class="op">=</span><span class="dv">8</span>, ylabelsize<span class="op">=</span><span class="dv">8</span>)<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/6c46811d368dad65c062db8af6ad0e09e0ddb587.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Các thuộc tính như <code>1stFlrSF</code>, <code>TotalBsmtSF</code>,
<code>LotFrontage</code>, <code>GrLiveArea</code>... có phân phối giá
trị giống với nhau và giống với mục tiêu <code>SalePrice</code>. Ta sẽ
thử tìm hiểu sự tương quan giữa các biến này với biến mục tiêu</p>
</div>
<section id="33-sự-tương-quan-correlation" class="cell markdown">
<h2>3.3. Sự tương quan (Correlation)</h2>
</section>
<div class="cell markdown">
<p>Ta sẽ tìm những thuộc tính nào có mối tương quan chặt chẽ với
<code>SalePrice</code>.</p>
</div>
<div class="cell markdown">
<p>Vẽ Correlation matrix để biểu diễn mối tương quan giữa các thuộc tính
với nhau và với <code>SalePrice</code></p>
</div>
<div class="cell code" data-execution_count="19">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> df_num.corr()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">12</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.heatmap(corr, vmax=0.9, cmap=&quot;Blues&quot;, square=True,annot=True)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr, vmax<span class="op">=</span><span class="fl">0.9</span>, cmap<span class="op">=</span><span class="st">&quot;Blues&quot;</span>, square<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="19">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/b86429b8be467f4a401df90119083127d1c82fad.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Chúng ta lưu những thuộc tính có mối tương quan mạnh với
<code>SalePrice</code> vào một biến có tên là
<code>golden_features_list</code></p>
</div>
<div class="cell code" data-execution_count="20" data-scrolled="true">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df_num_corr <span class="op">=</span> corr[<span class="st">&#39;SalePrice&#39;</span>][:<span class="op">-</span><span class="dv">1</span>] <span class="co"># Lấy dòng &#39;SalePrice&#39; bỏ ô cuối</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>golden_features_list <span class="op">=</span> df_num_corr[<span class="bu">abs</span>(df_num_corr) <span class="op">&gt;</span> <span class="fl">0.5</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Có </span><span class="sc">{}</span><span class="st"> giá trị tương quan chặt chẽ với SalePrice ( độ tương quan từ 50% trở lên ):</span><span class="ch">\n</span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">len</span>(golden_features_list), golden_features_list))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Có 10 giá trị tương quan chặt chẽ với SalePrice ( độ tương quan từ 50% trở lên ):
OverallQual     0.790982
GrLivArea       0.708624
GarageCars      0.640409
GarageArea      0.623431
TotalBsmtSF     0.613581
1stFlrSF        0.605852
FullBath        0.560664
TotRmsAbvGrd    0.533723
YearBuilt       0.522897
YearRemodAdd    0.507101
Name: SalePrice, dtype: float64
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Hoặc có thể biểu diễn cách trực quan bằng ma trận tương quan:</p>
</div>
<div class="cell code" data-execution_count="21">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">11</span>  <span class="co"># number of variables/features + SalePrice</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> corr.nlargest(k, <span class="st">&#39;SalePrice&#39;</span>)[<span class="st">&#39;SalePrice&#39;</span>].index</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">&quot;figure.figsize&quot;</span>] <span class="op">=</span> (<span class="dv">16</span>,<span class="dv">8</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> np.corrcoef(df_train[cols].values.T)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.25</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>hm <span class="op">=</span> sns.heatmap(cm, cbar<span class="op">=</span><span class="va">True</span>, annot<span class="op">=</span><span class="va">True</span>, square<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">&#39;.2f&#39;</span>, annot_kws<span class="op">=</span>{<span class="st">&#39;size&#39;</span>: <span class="dv">10</span>}, yticklabels<span class="op">=</span>cols.values, xticklabels<span class="op">=</span>cols.values, cmap<span class="op">=</span><span class="st">&#39;Blues&#39;</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/9b564ddeacfcdedf73bcebeb12fee8b942fd50a9.png" /></p>
</div>
</div>
<div class="cell markdown">
<ul>
<li>Ta thấy 2 biến 'TotalBsmtSF' và '1stFlrSF' có độ tương quan cao với
nhau. Có thể hiểu bởi việc cả hai đại diện cho các không gian sống chính
của ngôi nhà là tầng hầm và tầng trệt, và thường có kích thước tương tự
nhau.</li>
<li>Tuy Các biến GarageX(liên quan Garage - GarageArea, GarageCars) cũng
có độ tương quan cao với nhau nhưng đều cung cấp thông tin tương tự nhau
dẫn đến multicollinearity (đa cộng tuyến) </br> Mối tương quan giữa
GarageCars và GarageArea rất cao (0.88), và cả hai đều có mối tương quan
tương tự (cao) với SalePrice. Tuy nhiên, số xe có thể vừa với diện tích
garage là hệ quả của diện tích garage. 'GarageCars' và 'GarageArea'
giống như hai anh em sinh đôi. Ta sẽ không thể phân biệt được chúng. Ta
sẽ giữ 'GarageCars' vì mối tương quan của nó với 'Saleprice' cao hơn
GarageArea , bỏ cột GarageArea.</li>
</ul>
<p>Multicollinearity có thể gây khó khăn trong việc xây dựng mô hình dự
đoán chính xác vì nó làm phát sinh vấn đề trong việc ước lượng các hệ số
của mô hình.</p>
<p>Các biến số khác có mối tương quan cao hơn 0.5 với SalePrice là:</p>
<ul>
<li>TotalBsmtSF: Tổng diện tích tầng hầm<br />
</li>
<li>1stFlrSF: Diện tích tầng một<br />
</li>
<li>FullBath: Phòng tắm đầy đủ phía trên mặt đất<br />
</li>
<li>TotRmsAbvGrd: Tổng số phòng phía trên mặt đất (không bao gồm phòng
tắm)<br />
</li>
<li>YearBuilt: Ngày xây dựng ban đầu<br />
</li>
<li>YearRemodAdd: Ngày cải tạo (cùng với ngày xây dựng nếu không có cải
tạo hoặc thêm vào)</li>
</ul>
</div>
<div class="cell markdown">
<p>Trong phần còn lại của mục này, chúng ta sẽ trực quan hóa mối quan hệ
giữa <code>SalePrice</code> và hai yếu tố dự đoán có mối tương quan cao
nhất với <code>SalePrice</code>; Chất lượng tổng thể
(<code>OverallQual</code>) và Diện tích sống (<code>GrLivArea</code>)
(phần này là tỷ lệ của ngôi nhà không nằm trong tầng hầm).</p>
</div>
<div class="cell markdown">
<ul>
<li><h3 id="chất-lượng-tổng-thể-overallqual">Chất lượng tổng thể
(<code>OverallQual</code>)</h3></li>
</ul>
</div>
<div class="cell markdown">
<p>Chất lượng tổng thể có mối tương quan với SalePrice cao nhất trong số
các biến số (0,79). Nó đánh giá vật liệu tổng thể và độ hoàn thiện của
ngôi nhà theo thang điểm từ 1 (rất kém) đến 10 (rất xuất sắc).</p>
</div>
<div class="cell markdown">
<pre><code>   10	Very Excellent
   9	Excellent
   8	Very Good
   7	Good
   6	Above Average
   5	Average
   4	Below Average
   3	Fair
   2	Poor
   1	Very Poor</code></pre>
</div>
<div class="cell code" data-execution_count="22">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#box plot overallqual/saleprice</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">&#39;OverallQual&#39;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.concat([df_train[<span class="st">&#39;SalePrice&#39;</span>], df_train[var]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>f, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> sns.boxplot(x<span class="op">=</span>var, y<span class="op">=</span><span class="st">&quot;SalePrice&quot;</span>, data<span class="op">=</span>data)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>fig.axis(ymin<span class="op">=</span><span class="dv">0</span>, ymax<span class="op">=</span><span class="dv">800000</span>)<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/5a4feb198f95496d225c26f8357565b850a09391.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Mối tương quan tích cực (positive) chắc chắn là có và dường như là
một đường cong hơi hướng lên trên. Về các ngoại lệ, chúng tôi không thấy
bất kỳ giá trị cực đoan nào. Nếu sau này có ứng cử viên nào được đưa ra
làm ngoại lệ (outlier) thì có vẻ đó là nhà với số điểm 4. </br> Với sự
tăng của 'OverallQual', giá trung vị và phạm vi giá bán cũng có xu hướng
tăng theo. Điều này cho thấy một mối quan hệ tương đối tích cực giữa
chất lượng nhà và giá bán. </br> Sự phân tán của dữ liệu: IQR mở rộng và
sự xuất hiện của ngoại lệ tăng lên với các nhóm chất lượng cao, cho thấy
có sự phân tán lớn hơn trong giá bán của nhà có chất lượng cao. </br> Ta
thấy nếu OverallQual hay chất lượng tổng thể càng cao hay nhà càng được
đánh giá cao thì giá nhà SalePrice càng cao</p>
</div>
<div class="cell markdown">
<ul>
<li><h3 id="diện-tích-sinh-hoạt-trên-mặt-đất-grlivarea">Diện tích sinh
hoạt trên mặt đất (<code>GrLivArea</code>)</h3></li>
</ul>
</div>
<div class="cell markdown">
<p>Biến số có mối tương quan cao thứ hai với SalePrice là Khu vực sinh
hoạt trên mặt đất. Rõ ràng, những ngôi nhà lớn thường đắt hơn.</p>
</div>
<div class="cell code" data-execution_count="23">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tạo DataFrame</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.concat([df_train[<span class="st">&#39;SalePrice&#39;</span>], df_train[<span class="st">&#39;GrLivArea&#39;</span>]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Vẽ biểu đồ phân tán</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))  <span class="co"># Kích thước tùy chọn</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> data.plot.scatter(x<span class="op">=</span><span class="st">&#39;GrLivArea&#39;</span>, y<span class="op">=</span><span class="st">&#39;SalePrice&#39;</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, ylim<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">800000</span>))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Tính toán hồi quy tuyến tính</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> data[<span class="st">&#39;GrLivArea&#39;</span>]</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data[<span class="st">&#39;SalePrice&#39;</span>]</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.vstack([x, np.ones(<span class="bu">len</span>(x))]).T</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>m, c <span class="op">=</span> np.linalg.lstsq(A, y, rcond<span class="op">=</span><span class="va">None</span>)[<span class="dv">0</span>]</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Vẽ đường tuyến tính</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>plt.plot(x, m<span class="op">*</span>x <span class="op">+</span> c, <span class="st">&#39;black&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Thêm chú thích và hiển thị biểu đồ</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output stream stderr">
<pre><code>*c* argument looks like a single numeric RGB or RGBA sequence, which should be avoided as value-mapping will have precedence in case its length matches with *x* &amp; *y*.  Please use the *color* keyword-argument or provide a 2D array with a single row if you intend to specify the same RGB or RGBA value for all points.
No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 1000x600 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/00348f40d1ddb9700116525fbfb61abe8b84b069.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Đặc biệt ở đây có hai căn nhà với khu vực sinh hoạt rất rộng và giá
bán thấp, có vẻ như là những điểm ngoại lệ. Chúng tôi sẽ chưa loại bỏ
chúng ngay bây giờ, vì loại bỏ các điểm ngoại lệ có thể rất nguy hiểm.
Chẳng hạn, điểm số thấp về Chất lượng Tổng thể có thể giải thích giá
thấp. Tuy nhiên, điểm số Chất lượng Tổng thể cũng có thể cao. Do đó,
chúng tôi sẽ tiếp tục để ý đến 2 căn nhà và xem đây là những ứng cử viên
hàng đầu để loại bỏ như là các điểm ngoại lệ.</p>
</div>
<div class="cell markdown">
<ul>
<li><h3 id="một-vài-thuộc-tính-khác">Một vài thuộc tính khác</h3></li>
</ul>
</div>
<div class="cell markdown">
<p>YearBuilt : Năm xây dựng của ngôi nhà</p>
</div>
<div class="cell code" data-execution_count="24">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tạo DataFrame</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.concat([df_train[<span class="st">&#39;SalePrice&#39;</span>], df_train[<span class="st">&#39;YearBuilt&#39;</span>]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Vẽ biểu đồ</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>f, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> sns.boxplot(x<span class="op">=</span><span class="st">&#39;YearBuilt&#39;</span>, y<span class="op">=</span><span class="st">&quot;SalePrice&quot;</span>, data<span class="op">=</span>data)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>fig.axis(ymin<span class="op">=</span><span class="dv">0</span>, ymax<span class="op">=</span><span class="dv">800000</span>)<span class="op">;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Điều chỉnh các nhãn trên trục x</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Chỉ hiển thị mỗi năm đầu tiên của mỗi thập kỷ</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>start_year <span class="op">=</span> <span class="dv">1870</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>end_year <span class="op">=</span> <span class="dv">2010</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>step <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> [year <span class="cf">for</span> year <span class="kw">in</span> <span class="bu">range</span>(start_year, end_year <span class="op">+</span> <span class="dv">1</span>, step)]</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="bu">str</span>(year) <span class="cf">if</span> year <span class="kw">in</span> ticks <span class="cf">else</span> <span class="st">&#39;&#39;</span> <span class="cf">for</span> year <span class="kw">in</span> <span class="bu">sorted</span>(data[<span class="st">&#39;YearBuilt&#39;</span>].unique())]</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span><span class="bu">range</span>(<span class="bu">len</span>(labels)), labels<span class="op">=</span>labels, rotation<span class="op">=</span><span class="dv">90</span>)  <span class="co"># Xoay nhãn để dễ đọc hơn</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/6cddedc8be7b2c49581d096ef8e3d791590f9644.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Mặc dù không phải là một xu hướng mạnh mẽ, nhưng ta thấy 'SalePrice'
có xu hướng tăng với các mẫu có mới hơn là các ngôi nhà được xây từ
lâu</p>
</div>
<div class="cell markdown">
<p>TotalBsmtSF: Total square feet of basement area - Tổng diện tích của
khu vực tầng hầm tính bằng feet vuông.</p>
</div>
<div class="cell code" data-execution_count="25">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">&#39;TotalBsmtSF&#39;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Hệ số tương quan giữa SalePrice và </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss"> &#39;</span>,df_train[<span class="st">&#39;SalePrice&#39;</span>].corr(df_train[var]))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.concat([df_train[<span class="st">&#39;SalePrice&#39;</span>], df_train[var]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>data.plot.scatter(x<span class="op">=</span><span class="st">&#39;TotalBsmtSF&#39;</span>, y<span class="op">=</span><span class="st">&#39;SalePrice&#39;</span>, alpha<span class="op">=</span><span class="fl">0.4</span>, ylim<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">800000</span>))<span class="op">;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#data.plot.scatter(x=&#39;TotalBsmtSF&#39;, y=&#39;SalePrice&#39;, ylim=(0,800000));</span></span></code></pre></div>
<div class="output stream stderr">
<pre><code>*c* argument looks like a single numeric RGB or RGBA sequence, which should be avoided as value-mapping will have precedence in case its length matches with *x* &amp; *y*.  Please use the *color* keyword-argument or provide a 2D array with a single row if you intend to specify the same RGB or RGBA value for all points.
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Hệ số tương quan giữa SalePrice và TotalBsmtSF  0.6135805515591954
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/c4771d11995d0e56d1a890aa06ff5054cf6a7a33.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="26">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">&#39;FullBath&#39;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Hệ số tương quan giữa SalePrice và </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss"> &#39;</span>,df_train[<span class="st">&#39;SalePrice&#39;</span>].corr(df_train[var]))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.concat([df_train[<span class="st">&#39;SalePrice&#39;</span>], df_train[var]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>data.plot.scatter(x<span class="op">=</span>var, y<span class="op">=</span><span class="st">&#39;SalePrice&#39;</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, ylim<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">800000</span>))<span class="op">;</span></span></code></pre></div>
<div class="output stream stderr">
<pre><code>*c* argument looks like a single numeric RGB or RGBA sequence, which should be avoided as value-mapping will have precedence in case its length matches with *x* &amp; *y*.  Please use the *color* keyword-argument or provide a 2D array with a single row if you intend to specify the same RGB or RGBA value for all points.
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Hệ số tương quan giữa SalePrice và FullBath  0.5606637627484453
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/d61b1f36e236358f0fa8545b3e0d2db634a76e28.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Các giá trị SalePrice phân tán khá rộng, đặc biệt là ở các giá trị
FullBath cao hơn, điều này có thể cho thấy rằng giá nhà không chỉ phụ
thuộc vào số lượng phòng tắm mà còn vào nhiều yếu tố khác. </br>
FullBath có ý nghĩa trong việc dự đoán SalePrice và có thể giúp cải
thiện độ chính xác của mô hình dự đoán khi kết hợp với các biến
khác.</p>
</div>
<section id="4-feature-engineering" class="cell markdown">
<h1>4. Feature Engineering</h1>
</section>
<section id="41-xử-lý-ngoại-lệ-outliers" class="cell markdown">
<h2>4.1. Xử lý ngoại lệ (Outliers)</h2>
</section>
<div class="cell markdown">
<p>Ở phần này, ta sẽ xem xét sự phân bố giá trị của các thuộc tính đặc
trưng Từ mục 3.3, ta có thể một số ngoại lệ (Outlier) ở các
OverallQual/SalePrice và GrLivArea/SalePrice.</p>
</div>
<div class="cell code" data-execution_count="27">
<div class="sourceCode" id="cb46"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loại bỏ các ngoại lệ</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>df_train.drop(df_train[(df_train[<span class="st">&#39;OverallQual&#39;</span>]<span class="op">&lt;</span><span class="dv">5</span>) <span class="op">&amp;</span> (df_train[<span class="st">&#39;SalePrice&#39;</span>]<span class="op">&gt;</span><span class="dv">200000</span>)].index, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>df_train.drop(df_train[(df_train[<span class="st">&#39;GrLivArea&#39;</span>]<span class="op">&gt;</span><span class="dv">4500</span>) <span class="op">&amp;</span> (df_train[<span class="st">&#39;SalePrice&#39;</span>]<span class="op">&lt;</span><span class="dv">300000</span>)].index, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>df_train.reset_index(drop<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Kiểm tra lại sau khi loại bỏ các outlier</p>
</div>
<div class="cell code" data-execution_count="28">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Vẽ lại GrLivArea/SalePrice</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>ax.scatter(df_train[<span class="st">&#39;GrLivArea&#39;</span>], df_train[<span class="st">&#39;SalePrice&#39;</span>])</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;SalePrice&#39;</span>, fontsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;GrLivArea&#39;</span>, fontsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/97dc6adacb452ea81b3bec0c0501d5734a22717d.png" /></p>
</div>
</div>
<section id="42-log-transformation" class="cell markdown">
<h2>4.2. Log Transformation</h2>
</section>
<div class="cell markdown">
<p>Như đã phân tích ở mục 3.1, <code>SalePrice</code> bị lệch sang phải.
Đây là một vấn đề, vì hầu hết các mô hình ML không hoạt động tốt với dữ
liệu không được phân phối chuẩn. Chúng ta phi tuyến tính hóa cho biến
mục tiêu bằng cách áp dụng biến đổi <code>log(1+x)</code> (logarit tự
nhiên cơ số e) để giảm độ lệch của phân phối và làm cho dữ liệu gần với
phân phối chuẩn hơn, giúp cải thiện hiệu suất của các mô hình dự đoán
.</p>
</div>
<div class="cell code" data-execution_count="29">
<div class="sourceCode" id="cb48"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log(1+SalePrice) transform</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>df_train[<span class="st">&quot;SalePrice&quot;</span>] <span class="op">=</span> np.log1p(df_train[<span class="st">&quot;SalePrice&quot;</span>])</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Biểu đồ phân phối giá trị của SalePrice</p>
</div>
<div class="cell code" data-execution_count="30">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Kiểm tra phân phối mới </span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># xanh dương - đường cong phân phối chuẩn (normal distribution) để so sánh phân phối của dữ liệu đã biến đổi với phân phối chuẩn.</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>sns.distplot(df_train[<span class="st">&#39;SalePrice&#39;</span>] , fit<span class="op">=</span>norm)<span class="op">;</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Lấy các tham số phù hợp được sử dụng</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>(mu, sigma) <span class="op">=</span> norm.fit(df_train[<span class="st">&#39;SalePrice&#39;</span>])</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( <span class="st">&#39;</span><span class="ch">\n</span><span class="st"> Giá trị trung bình μ hay mu = </span><span class="sc">{:.2f}</span><span class="st"> và độ lệch chuẩn của phân phối σ hay sigma = </span><span class="sc">{:.2f}</span><span class="ch">\n</span><span class="st">&#39;</span>.<span class="bu">format</span>(mu, sigma))</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Vẽ đồ thị phân phối</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&#39;Normal dist. ($\mu=$ </span><span class="sc">{:.2f}</span><span class="st"> and $\sigma=$ </span><span class="sc">{:.2f}</span><span class="st"> )&#39;</span>.<span class="bu">format</span>(mu, sigma)],</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>            loc<span class="op">=</span><span class="st">&#39;best&#39;</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;SalePrice distribution&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
 Giá trị trung bình μ hay mu = 12.02 và độ lệch chuẩn của phân phối σ hay sigma = 0.40

</code></pre>
</div>
<div class="output execute_result" data-execution_count="30">
<pre><code>Text(0.5, 1.0, &#39;SalePrice distribution&#39;)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/c043de0180d4f971ff2b8ab5eaf69438e017ffbb.png" /></p>
</div>
</div>
<div class="cell markdown">
<ul>
<li>Đường cong xanh dương :Ta thấy thấy rằng dữ liệu sau khi biến đổi có
phân phối gần giống với phân phối chuẩn.</li>
<li>Đường cong đen: hân phối thực tế của dữ liệu SalePrice sau khi biến
đổi log. Nó cho thấy tần suất xuất hiện của các giá trị SalePrice đã
biến đổi.</li>
</ul>
</div>
<div class="cell code" data-execution_count="31">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get also the QQ-plot  (Quantile-Quantile plot)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> stats.probplot(df_train[<span class="st">&#39;SalePrice&#39;</span>], plot<span class="op">=</span>plt)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/05ac24928ae809fd5cdc9993b087cb6b4b1944c0.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>QQ-plot này cho thấy rằng sau khi áp dụng phép biến đổi
log(1+SalePrice), phân phối của biến SalePrice gần với phân phối chuẩn .
Các điểm xanh (SalePrice) nằm hầu như trên trục đỏ (phân phối chuẩn) . Ở
2 đầu đồ thị có 1 vài điểm ngoại lệ lệch khỏi đường thẳng đỏ nhưng không
ảnh hưởng nhiều đến phân phối tổng thể.</p>
</div>
<div class="cell markdown">
<p>Nối dữ liệu train và dữ liệu test trong cùng một dataframe có tên là
<code>all_data</code></p>
</div>
<div class="cell code" data-execution_count="32">
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ntrain <span class="op">=</span> df_train.shape[<span class="dv">0</span>]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>ntest <span class="op">=</span> df_test.shape[<span class="dv">0</span>]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> df_train.SalePrice.values</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> pd.concat((df_train, df_test)).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>all_data.drop([<span class="st">&#39;SalePrice&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;size của all_data là: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(all_data.shape))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>size của all_data là: (2916, 79)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="33">
<div class="sourceCode" id="cb55"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>all_data.head(<span class="dv">5</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="33">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>LotConfig</th>
      <th>...</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>60</td>
      <td>RL</td>
      <td>65.0</td>
      <td>8450</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Inside</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20</td>
      <td>RL</td>
      <td>80.0</td>
      <td>9600</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>FR2</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2007</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
    <tr>
      <th>2</th>
      <td>60</td>
      <td>RL</td>
      <td>68.0</td>
      <td>11250</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Inside</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>9</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
    <tr>
      <th>3</th>
      <td>70</td>
      <td>RL</td>
      <td>60.0</td>
      <td>9550</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Corner</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2006</td>
      <td>WD</td>
      <td>Abnorml</td>
    </tr>
    <tr>
      <th>4</th>
      <td>60</td>
      <td>RL</td>
      <td>84.0</td>
      <td>14260</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>FR2</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>12</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 79 columns</p>
</div>
</div>
</div>
<section id="43-missing-data-and-imputation" class="cell markdown">
<h2>4.3. Missing Data and Imputation</h2>
</section>
<section id="431-kiểm-tra-missing-data" class="cell markdown">
<h3>4.3.1. Kiểm tra Missing Data</h3>
</section>
<div class="cell code" data-execution_count="34">
<div class="sourceCode" id="cb56"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>all_data_na <span class="op">=</span> (all_data.isnull().<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(all_data)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>all_data_na <span class="op">=</span> all_data_na.drop(all_data_na[all_data_na <span class="op">==</span> <span class="dv">0</span>].index).sort_values(ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">30</span>]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>missing_data <span class="op">=</span> pd.DataFrame({<span class="st">&#39;Missing Ratio&#39;</span> :all_data_na})</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>missing_data.head(<span class="dv">20</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="34">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Missing Ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PoolQC</th>
      <td>99.691358</td>
    </tr>
    <tr>
      <th>MiscFeature</th>
      <td>96.399177</td>
    </tr>
    <tr>
      <th>Alley</th>
      <td>93.209877</td>
    </tr>
    <tr>
      <th>Fence</th>
      <td>80.418381</td>
    </tr>
    <tr>
      <th>FireplaceQu</th>
      <td>48.696845</td>
    </tr>
    <tr>
      <th>LotFrontage</th>
      <td>16.632373</td>
    </tr>
    <tr>
      <th>GarageFinish</th>
      <td>5.452675</td>
    </tr>
    <tr>
      <th>GarageQual</th>
      <td>5.452675</td>
    </tr>
    <tr>
      <th>GarageCond</th>
      <td>5.452675</td>
    </tr>
    <tr>
      <th>GarageYrBlt</th>
      <td>5.452675</td>
    </tr>
    <tr>
      <th>GarageType</th>
      <td>5.384088</td>
    </tr>
    <tr>
      <th>BsmtExposure</th>
      <td>2.812071</td>
    </tr>
    <tr>
      <th>BsmtCond</th>
      <td>2.812071</td>
    </tr>
    <tr>
      <th>BsmtQual</th>
      <td>2.777778</td>
    </tr>
    <tr>
      <th>BsmtFinType2</th>
      <td>2.743484</td>
    </tr>
    <tr>
      <th>BsmtFinType1</th>
      <td>2.709191</td>
    </tr>
    <tr>
      <th>MasVnrType</th>
      <td>0.823045</td>
    </tr>
    <tr>
      <th>MasVnrArea</th>
      <td>0.788752</td>
    </tr>
    <tr>
      <th>MSZoning</th>
      <td>0.137174</td>
    </tr>
    <tr>
      <th>BsmtFullBath</th>
      <td>0.068587</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="35">
<div class="sourceCode" id="cb57"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>f, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">12</span>))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>all_data_na.index, y<span class="op">=</span>all_data_na)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Features&#39;</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Percent of missing values&#39;</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Percent missing data by feature&#39;</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="35">
<pre><code>Text(0.5, 1.0, &#39;Percent missing data by feature&#39;)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_50a71e14ab0344f6a6b55b88b310ef98/67f545f1175f093a25a793298f5138ecf8fbaf81.png" /></p>
</div>
</div>
<section id="432-imputing-missing-data" class="cell markdown">
<h3>4.3.2. Imputing Missing Data</h3>
</section>
<div class="cell markdown">
<p>Chúng tôi impute chúng bằng cách tiến hành tuần tự các thuộc tính có
giá trị bị thiếu</p>
</div>
<div class="cell markdown">
<ul>
<li><code>PoolQC</code>: mô tả dữ liệu cho biết NA có nghĩa là "Không có
hồ". Điều đó hợp lý với tỷ lệ giá trị còn thiếu rất lớn (+99%) và phần
lớn các ngôi nhà nói chung không có Hồ bơi.</li>
</ul>
</div>
<div class="cell code" data-execution_count="36">
<div class="sourceCode" id="cb59"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&quot;PoolQC&quot;</span>] <span class="op">=</span> all_data[<span class="st">&quot;PoolQC&quot;</span>].fillna(<span class="st">&quot;None&quot;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>MiscFeature</code>: mô tả dữ liệu cho biết NA có nghĩa là
"không có tính năng thêm"</li>
</ul>
</div>
<div class="cell code" data-execution_count="37">
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&quot;MiscFeature&quot;</span>] <span class="op">=</span> all_data[<span class="st">&quot;MiscFeature&quot;</span>].fillna(<span class="st">&quot;None&quot;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>Alley</code> : mô tả dữ liệu cho biết NA có nghĩa là "không có
ngõ vào"</li>
</ul>
</div>
<div class="cell code" data-execution_count="38">
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&quot;Alley&quot;</span>] <span class="op">=</span> all_data[<span class="st">&quot;Alley&quot;</span>].fillna(<span class="st">&quot;None&quot;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>Fence</code>: mô tả dữ liệu cho biết NA có nghĩa là "không có
hàng rào"</li>
</ul>
</div>
<div class="cell code" data-execution_count="39">
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&quot;Fence&quot;</span>] <span class="op">=</span> all_data[<span class="st">&quot;Fence&quot;</span>].fillna(<span class="st">&quot;None&quot;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>FireplaceQu</code>: mô tả dữ liệu cho biết NA có nghĩa là
"không có lò sưởi"</li>
</ul>
</div>
<div class="cell code" data-execution_count="40">
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&quot;FireplaceQu&quot;</span>] <span class="op">=</span> all_data[<span class="st">&quot;FireplaceQu&quot;</span>].fillna(<span class="st">&quot;None&quot;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>LotFrontage</code> : Vì diện tích của mỗi con đường nối với
ngôi nhà có thể có diện tích tương tự với các ngôi nhà khác trong vùng
lân cận của nó, nên chúng ta có thể điền các giá trị còn thiếu bằng
LotFrontage trung bình của vùng lân cận.</li>
</ul>
</div>
<div class="cell code" data-execution_count="41">
<div class="sourceCode" id="cb64"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nhóm theo vùng lân cận và điền giá trị còn thiếu theo LotFrontage trung bình của tất cả vùng lân cận</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&quot;LotFrontage&quot;</span>] <span class="op">=</span> all_data.groupby(<span class="st">&quot;Neighborhood&quot;</span>)[<span class="st">&quot;LotFrontage&quot;</span>].transform(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: x.fillna(x.median()))</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>GarageType</code>, <code>GarageFinish</code>,
<code>GarageQual</code> và <code>GarageCond</code> : Thay thế dữ liệu bị
thiếu bằng None</li>
</ul>
</div>
<div class="cell code" data-execution_count="42">
<div class="sourceCode" id="cb65"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> (<span class="st">&#39;GarageType&#39;</span>, <span class="st">&#39;GarageFinish&#39;</span>, <span class="st">&#39;GarageQual&#39;</span>, <span class="st">&#39;GarageCond&#39;</span>):</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    all_data[col] <span class="op">=</span> all_data[col].fillna(<span class="st">&#39;None&#39;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>GarageYrBlt</code>, <code>GarageArea</code> và
<code>GarageCars</code> : Thay thế dữ liệu bị thiếu bằng 0 (Vì Không có
gara = không có ô tô trong gara)</li>
</ul>
</div>
<div class="cell code" data-execution_count="43">
<div class="sourceCode" id="cb66"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> (<span class="st">&#39;GarageYrBlt&#39;</span>, <span class="st">&#39;GarageArea&#39;</span>, <span class="st">&#39;GarageCars&#39;</span>):</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    all_data[col] <span class="op">=</span> all_data[col].fillna(<span class="dv">0</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>BsmtFinSF1</code>, <code>BsmtFinSF2</code>,
<code>BsmtUnfSF</code>, <code>TotalBsmtSF</code>,
<code>BsmtFullBath</code> và <code>BsmtHalfBath</code> : các giá trị bị
thiếu có thể bằng 0 vì không có tầng hầm</li>
</ul>
</div>
<div class="cell code" data-execution_count="44">
<div class="sourceCode" id="cb67"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> (<span class="st">&#39;BsmtFinSF1&#39;</span>, <span class="st">&#39;BsmtFinSF2&#39;</span>, <span class="st">&#39;BsmtUnfSF&#39;</span>,<span class="st">&#39;TotalBsmtSF&#39;</span>, <span class="st">&#39;BsmtFullBath&#39;</span>, <span class="st">&#39;BsmtHalfBath&#39;</span>):</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    all_data[col] <span class="op">=</span> all_data[col].fillna(<span class="dv">0</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>BsmtQual</code>, <code>BsmtCond</code>,
<code>BsmtExposure</code>, <code>BsmtFinType1</code> và
<code>BsmtFinType2</code> : Đối với tất cả các tính năng phân loại liên
quan đến tầng hầm này, NaN có nghĩa là không có tầng hầm.</li>
</ul>
</div>
<div class="cell code" data-execution_count="45">
<div class="sourceCode" id="cb68"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> (<span class="st">&#39;BsmtQual&#39;</span>, <span class="st">&#39;BsmtCond&#39;</span>, <span class="st">&#39;BsmtExposure&#39;</span>, <span class="st">&#39;BsmtFinType1&#39;</span>, <span class="st">&#39;BsmtFinType2&#39;</span>):</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    all_data[col] <span class="op">=</span> all_data[col].fillna(<span class="st">&#39;None&#39;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>MasVnrArea</code> và <code>MasVnrType</code> : NA rất có thể
có nghĩa là không có lớp vữa xây cho những ngôi nhà này. Chúng ta có thể
điền 0 cho vùng (area) và None cho loại (type).</li>
</ul>
</div>
<div class="cell code" data-execution_count="46">
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&quot;MasVnrType&quot;</span>] <span class="op">=</span> all_data[<span class="st">&quot;MasVnrType&quot;</span>].fillna(<span class="st">&quot;None&quot;</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&quot;MasVnrArea&quot;</span>] <span class="op">=</span> all_data[<span class="st">&quot;MasVnrArea&quot;</span>].fillna(<span class="dv">0</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>MSZoning</code> (Phân loại phân vùng chung): 'RL' cho đến nay
là giá trị phổ biến nhất. Vì vậy chúng ta có thể điền vào các giá trị
còn thiếu bằng 'RL'</li>
</ul>
</div>
<div class="cell code" data-execution_count="47">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;MSZoning&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;MSZoning&#39;</span>].fillna(all_data[<span class="st">&#39;MSZoning&#39;</span>].mode()[<span class="dv">0</span>])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="48">
<div class="sourceCode" id="cb71"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>utilities_counts <span class="op">=</span> all_data[<span class="st">&#39;Utilities&#39;</span>].value_counts()</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Hiển thị kết quả</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(utilities_counts)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>AllPub    2913
NoSeWa       1
Name: Utilities, dtype: int64
</code></pre>
</div>
</div>
<div class="cell markdown">
<ul>
<li><code>Utilities</code> : Đối với tính năng phân loại này, tất cả các
bản ghi đều là "AllPub", ngoại trừ một "NoSeWa" và 2 NA. Vì ngôi nhà có
'NoSewa' nằm trong tập huấn luyện nên tính năng này sẽ không giúp ích gì
trong việc lập mô hình dự đoán. Sau đó chúng ta có thể loại bỏ nó một
cách an toàn.</li>
</ul>
</div>
<div class="cell code" data-execution_count="49">
<div class="sourceCode" id="cb73"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> all_data.drop([<span class="st">&#39;Utilities&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>Functional</code>: mô tả dữ liệu cho biết NA có nghĩa là
typical</li>
</ul>
</div>
<div class="cell code" data-execution_count="50">
<div class="sourceCode" id="cb74"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&quot;Functional&quot;</span>] <span class="op">=</span> all_data[<span class="st">&quot;Functional&quot;</span>].fillna(<span class="st">&quot;Typ&quot;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>Electrical</code>: Nó có một giá trị NA. Vì tính năng này chủ
yếu có 'SBrkr' nên chúng tôi có thể đặt giá trị đó cho giá trị còn
thiếu.</li>
</ul>
</div>
<div class="cell code" data-execution_count="51">
<div class="sourceCode" id="cb75"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;Electrical&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;Electrical&#39;</span>].fillna(all_data[<span class="st">&#39;Electrical&#39;</span>].mode()[<span class="dv">0</span>])</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>KitchenQual</code>: Chỉ có một giá trị NA và giống như
Electrical, chúng tôi đặt 'TA' (giá trị thường xuyên nhất) cho giá trị
còn thiếu trong KitchenQual.</li>
</ul>
</div>
<div class="cell code" data-execution_count="52">
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;KitchenQual&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;KitchenQual&#39;</span>].fillna(all_data[<span class="st">&#39;KitchenQual&#39;</span>].mode()[<span class="dv">0</span>])</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>Exterior1st</code> và <code>Exterior2nd</code> : Một lần nữa
Cả Exterior 1 &amp; 2 chỉ thiếu một giá trị. Chúng tôi sẽ chỉ thay thế
bằng chuỗi phổ biến nhất.</li>
</ul>
</div>
<div class="cell code" data-execution_count="53">
<div class="sourceCode" id="cb77"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;Exterior1st&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;Exterior1st&#39;</span>].fillna(all_data[<span class="st">&#39;Exterior1st&#39;</span>].mode()[<span class="dv">0</span>])</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;Exterior2nd&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;Exterior2nd&#39;</span>].fillna(all_data[<span class="st">&#39;Exterior2nd&#39;</span>].mode()[<span class="dv">0</span>])</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>SaleType</code> : Điền lại với tần suất thường xuyên nhất là
"WD"</li>
</ul>
</div>
<div class="cell code" data-execution_count="54">
<div class="sourceCode" id="cb78"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;SaleType&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;SaleType&#39;</span>].fillna(all_data[<span class="st">&#39;SaleType&#39;</span>].mode()[<span class="dv">0</span>])</span></code></pre></div>
</div>
<div class="cell markdown">
<ul>
<li><code>MSSubClass</code> : Na rất có thể có nghĩa là Không có lớp xây
dựng. Chúng ta có thể thay thế các giá trị bị thiếu bằng None.</li>
</ul>
</div>
<div class="cell code" data-execution_count="55">
<div class="sourceCode" id="cb79"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;MSSubClass&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;MSSubClass&#39;</span>].fillna(<span class="st">&quot;None&quot;</span>)</span></code></pre></div>
</div>
<section id="44-transformation" class="cell markdown">
<h3>4.4. Transformation</h3>
</section>
<div class="cell markdown">
<p>Chuyển đổi một số biến số sang phân loại</p>
</div>
<div class="cell code" data-execution_count="56">
<div class="sourceCode" id="cb80"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#MSSubClass=Lớp tòa nhà</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;MSSubClass&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;MSSubClass&#39;</span>].<span class="bu">apply</span>(<span class="bu">str</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Chuyển đổi OverallCond thành biến phân loại</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;OverallCond&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;OverallCond&#39;</span>].astype(<span class="bu">str</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Năm và tháng bán được chuyển đổi thành các đặc trưng phân loại.</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;YrSold&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;YrSold&#39;</span>].astype(<span class="bu">str</span>)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;MoSold&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;MoSold&#39;</span>].astype(<span class="bu">str</span>)</span></code></pre></div>
</div>
<div class="cell code">
<div class="sourceCode" id="cb81"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
<section id="45-label-encoding" class="cell markdown">
<h3>4.5. Label Encoding</h3>
</section>
<div class="cell markdown">
<p>Mã hóa nhãn cho một số biến phân loại có thể chứa thông tin trong tập
hợp thứ tự của chúng.</p>
</div>
<div class="cell code" data-execution_count="57">
<div class="sourceCode" id="cb82"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> (<span class="st">&#39;FireplaceQu&#39;</span>, <span class="st">&#39;BsmtQual&#39;</span>, <span class="st">&#39;BsmtCond&#39;</span>, <span class="st">&#39;GarageQual&#39;</span>, <span class="st">&#39;GarageCond&#39;</span>, </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;ExterQual&#39;</span>, <span class="st">&#39;ExterCond&#39;</span>,<span class="st">&#39;HeatingQC&#39;</span>, <span class="st">&#39;PoolQC&#39;</span>, <span class="st">&#39;KitchenQual&#39;</span>, <span class="st">&#39;BsmtFinType1&#39;</span>, </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;BsmtFinType2&#39;</span>, <span class="st">&#39;Functional&#39;</span>, <span class="st">&#39;Fence&#39;</span>, <span class="st">&#39;BsmtExposure&#39;</span>, <span class="st">&#39;GarageFinish&#39;</span>, <span class="st">&#39;LandSlope&#39;</span>,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;LotShape&#39;</span>, <span class="st">&#39;PavedDrive&#39;</span>, <span class="st">&#39;Street&#39;</span>, <span class="st">&#39;Alley&#39;</span>, <span class="st">&#39;CentralAir&#39;</span>, <span class="st">&#39;MSSubClass&#39;</span>, <span class="st">&#39;OverallCond&#39;</span>, </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;YrSold&#39;</span>, <span class="st">&#39;MoSold&#39;</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Xử lý các cột, áp dụng LabelEncoder cho các đặc trưng phân loại</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> cols:</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    lbl <span class="op">=</span> LabelEncoder() </span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    lbl.fit(<span class="bu">list</span>(all_data[c].values)) </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    all_data[c] <span class="op">=</span> lbl.transform(<span class="bu">list</span>(all_data[c].values))</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co"># in ra kích thước dữ liệu</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Shape all_data: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(all_data.shape))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Shape all_data: (2916, 78)
</code></pre>
</div>
</div>
<section id="46-adding-feature" class="cell markdown">
<h3>4.6. Adding feature</h3>
</section>
<div class="cell markdown">
<p>Vì các đặc điểm liên quan đến diện tích rất quan trọng để xác định
giá nhà nên chúng tôi bổ sung thêm một đặc điểm nữa đó là tổng diện tích
tầng hầm, tầng một và tầng hai của mỗi ngôi nhà.</p>
</div>
<div class="cell code" data-execution_count="58">
<div class="sourceCode" id="cb84"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Thêm thuộc tính tổng diện tích</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>all_data[<span class="st">&#39;TotalSF&#39;</span>] <span class="op">=</span> all_data[<span class="st">&#39;TotalBsmtSF&#39;</span>] <span class="op">+</span> all_data[<span class="st">&#39;1stFlrSF&#39;</span>] <span class="op">+</span> all_data[<span class="st">&#39;2ndFlrSF&#39;</span>]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="59">
<div class="sourceCode" id="cb85"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>all_data.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2916 entries, 0 to 2915
Data columns (total 79 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   MSSubClass     2916 non-null   int32  
 1   MSZoning       2916 non-null   object 
 2   LotFrontage    2916 non-null   float64
 3   LotArea        2916 non-null   int64  
 4   Street         2916 non-null   int32  
 5   Alley          2916 non-null   int32  
 6   LotShape       2916 non-null   int32  
 7   LandContour    2916 non-null   object 
 8   LotConfig      2916 non-null   object 
 9   LandSlope      2916 non-null   int32  
 10  Neighborhood   2916 non-null   object 
 11  Condition1     2916 non-null   object 
 12  Condition2     2916 non-null   object 
 13  BldgType       2916 non-null   object 
 14  HouseStyle     2916 non-null   object 
 15  OverallQual    2916 non-null   int64  
 16  OverallCond    2916 non-null   int32  
 17  YearBuilt      2916 non-null   int64  
 18  YearRemodAdd   2916 non-null   int64  
 19  RoofStyle      2916 non-null   object 
 20  RoofMatl       2916 non-null   object 
 21  Exterior1st    2916 non-null   object 
 22  Exterior2nd    2916 non-null   object 
 23  MasVnrType     2916 non-null   object 
 24  MasVnrArea     2916 non-null   float64
 25  ExterQual      2916 non-null   int32  
 26  ExterCond      2916 non-null   int32  
 27  Foundation     2916 non-null   object 
 28  BsmtQual       2916 non-null   int32  
 29  BsmtCond       2916 non-null   int32  
 30  BsmtExposure   2916 non-null   int32  
 31  BsmtFinType1   2916 non-null   int32  
 32  BsmtFinSF1     2916 non-null   float64
 33  BsmtFinType2   2916 non-null   int32  
 34  BsmtFinSF2     2916 non-null   float64
 35  BsmtUnfSF      2916 non-null   float64
 36  TotalBsmtSF    2916 non-null   float64
 37  Heating        2916 non-null   object 
 38  HeatingQC      2916 non-null   int32  
 39  CentralAir     2916 non-null   int32  
 40  Electrical     2916 non-null   object 
 41  1stFlrSF       2916 non-null   int64  
 42  2ndFlrSF       2916 non-null   int64  
 43  LowQualFinSF   2916 non-null   int64  
 44  GrLivArea      2916 non-null   int64  
 45  BsmtFullBath   2916 non-null   float64
 46  BsmtHalfBath   2916 non-null   float64
 47  FullBath       2916 non-null   int64  
 48  HalfBath       2916 non-null   int64  
 49  BedroomAbvGr   2916 non-null   int64  
 50  KitchenAbvGr   2916 non-null   int64  
 51  KitchenQual    2916 non-null   int32  
 52  TotRmsAbvGrd   2916 non-null   int64  
 53  Functional     2916 non-null   int32  
 54  Fireplaces     2916 non-null   int64  
 55  FireplaceQu    2916 non-null   int32  
 56  GarageType     2916 non-null   object 
 57  GarageYrBlt    2916 non-null   float64
 58  GarageFinish   2916 non-null   int32  
 59  GarageCars     2916 non-null   float64
 60  GarageArea     2916 non-null   float64
 61  GarageQual     2916 non-null   int32  
 62  GarageCond     2916 non-null   int32  
 63  PavedDrive     2916 non-null   int32  
 64  WoodDeckSF     2916 non-null   int64  
 65  OpenPorchSF    2916 non-null   int64  
 66  EnclosedPorch  2916 non-null   int64  
 67  3SsnPorch      2916 non-null   int64  
 68  ScreenPorch    2916 non-null   int64  
 69  PoolArea       2916 non-null   int64  
 70  PoolQC         2916 non-null   int32  
 71  Fence          2916 non-null   int32  
 72  MiscFeature    2916 non-null   object 
 73  MiscVal        2916 non-null   int64  
 74  MoSold         2916 non-null   int32  
 75  YrSold         2916 non-null   int32  
 76  SaleType       2916 non-null   object 
 77  SaleCondition  2916 non-null   object 
 78  TotalSF        2916 non-null   float64
dtypes: float64(12), int32(26), int64(21), object(20)
memory usage: 1.5+ MB
</code></pre>
</div>
</div>
<section
id="47-skewed-features-and-box-cox-transformation-of-highly-skewed-features"
class="cell markdown">
<h3>4.7. Skewed features and Box Cox Transformation of (highly) skewed
features</h3>
</section>
<div class="cell code" data-execution_count="60">
<div class="sourceCode" id="cb87"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>numeric_feats <span class="op">=</span> all_data.dtypes[all_data.dtypes <span class="op">!=</span> <span class="st">&quot;object&quot;</span>].index</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Kiểm tra độ lệch của tất cả các thuộc tính số</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>skewed_feats <span class="op">=</span> all_data[numeric_feats].<span class="bu">apply</span>(<span class="kw">lambda</span> x: skew(x.dropna())).sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Skew in numerical features: </span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>skewness <span class="op">=</span> pd.DataFrame({<span class="st">&#39;Skew&#39;</span> :skewed_feats})</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>skewness.head(<span class="dv">10</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
Skew in numerical features: 

</code></pre>
</div>
<div class="output execute_result" data-execution_count="60">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Skew</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MiscVal</th>
      <td>21.935910</td>
    </tr>
    <tr>
      <th>PoolArea</th>
      <td>17.685603</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>13.262550</td>
    </tr>
    <tr>
      <th>LowQualFinSF</th>
      <td>12.082427</td>
    </tr>
    <tr>
      <th>3SsnPorch</th>
      <td>11.370087</td>
    </tr>
    <tr>
      <th>LandSlope</th>
      <td>4.994554</td>
    </tr>
    <tr>
      <th>KitchenAbvGr</th>
      <td>4.299698</td>
    </tr>
    <tr>
      <th>BsmtFinSF2</th>
      <td>4.143683</td>
    </tr>
    <tr>
      <th>EnclosedPorch</th>
      <td>4.001570</td>
    </tr>
    <tr>
      <th>ScreenPorch</th>
      <td>3.944305</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<ul>
<li><strong>Box Cox Transformation of (highly) skewed
features</strong></li>
</ul>
</div>
<div class="cell markdown">
<p>Chúng tôi sử dụng hàm scipy <code>boxcox1p</code> để tính toán phép
biến đổi Box-Cox cho (1 + x).</p>
<p>Lưu ý rằng việc đặt lambda =0 tương đương với việc sử dụng hàm
<code>log1p</code> (logrit tự nhiên cơ số e của (1+x) đã được dùng ở
trên cho biến mục tiêu.</p>
</div>
<div class="cell code" data-execution_count="61">
<div class="sourceCode" id="cb89"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>skewness <span class="op">=</span> skewness[<span class="bu">abs</span>(skewness) <span class="op">&gt;</span> <span class="fl">0.75</span>]</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Có </span><span class="sc">{}</span><span class="st"> đặc trưng số bị lệch cần được biến đổi Box Cox&quot;</span>.<span class="bu">format</span>(skewness.shape[<span class="dv">0</span>]))</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.special <span class="im">import</span> boxcox1p</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>skewed_features <span class="op">=</span> skewness.index</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>lam <span class="op">=</span> <span class="fl">0.15</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feat <span class="kw">in</span> skewed_features:</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#all_data[feat] += 1  # Tăng giá trị mỗi đặc trưng lên 1 (được bình luận và không sử dụng)</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    all_data[feat] <span class="op">=</span> boxcox1p(all_data[feat], lam)  <span class="co"># Áp dụng phép biến đổi Box-Cox với lambda = 0.15</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>Có 59 đặc trưng số bị lệch cần được biến đổi Box Cox
</code></pre>
</div>
</div>
<section id="48-dummy-features" class="cell markdown">
<h3>4.8. Dummy Features</h3>
</section>
<div class="cell markdown">
<p>Tạo các đặc trưng phân loại dạng dummy Chuyển các biến phân loại về
dạng nhị phân</p>
</div>
<div class="cell code" data-execution_count="68">
<div class="sourceCode" id="cb91"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> pd.get_dummies(all_data) <span class="co">#sẽ chuyển đổi mỗi giá trị duy nhất trong biến phân loại thành một cột mới. Mỗi cột này sẽ chứa giá trị 1 nếu hàng tương ứng thuộc danh mục đó và 0 nếu không.</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(all_data.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(2916, 220)
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Sau khi áp dụng pd.get_dummies trên DataFrame all_data, số lượng hàng
sẽ không thay đổi nhưng số lượng cột sẽ tăng lên tương ứng với số lượng
các giá trị phân loại duy nhất trong các biến phân loại.</p>
</div>
<section id="481-lưu-tập-dữ-liệu-đã-được-xử-lý-vào-định-dạng-parquet"
class="cell markdown">
<h3>4.8.1 Lưu tập dữ liệu đã được xử lý vào định dạng parquet</h3>
</section>
<div class="cell code" data-execution_count="71">
<div class="sourceCode" id="cb93"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>all_data.to_parquet(<span class="st">&#39;all_data.parquet&#39;</span>, index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="72">
<div class="sourceCode" id="cb94"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> pd.read_parquet(<span class="st">&#39;all_data.parquet&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="73">
<div class="sourceCode" id="cb95"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>all_data.shape</span></code></pre></div>
<div class="output execute_result" data-execution_count="73">
<pre><code>(2916, 220)</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Lấy tập dữ liệu train và test mới</p>
</div>
<div class="cell code" data-execution_count="113">
<div class="sourceCode" id="cb97"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> all_data[:ntrain]</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> all_data[ntrain:]</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train.shape)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(test.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(1457, 220)
(1459, 220)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="64">
<div class="sourceCode" id="cb99"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>train.head(<span class="dv">5</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="64">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MSSubClass</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandSlope</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>...</th>
      <th>SaleType_ConLw</th>
      <th>SaleType_New</th>
      <th>SaleType_Oth</th>
      <th>SaleType_WD</th>
      <th>SaleCondition_Abnorml</th>
      <th>SaleCondition_AdjLand</th>
      <th>SaleCondition_Alloca</th>
      <th>SaleCondition_Family</th>
      <th>SaleCondition_Normal</th>
      <th>SaleCondition_Partial</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.885846</td>
      <td>5.831328</td>
      <td>19.212182</td>
      <td>0.730463</td>
      <td>0.730463</td>
      <td>1.540963</td>
      <td>0.0</td>
      <td>2.440268</td>
      <td>1.820334</td>
      <td>14.187527</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.055642</td>
      <td>6.221214</td>
      <td>19.712205</td>
      <td>0.730463</td>
      <td>0.730463</td>
      <td>1.540963</td>
      <td>0.0</td>
      <td>2.259674</td>
      <td>2.440268</td>
      <td>14.145138</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.885846</td>
      <td>5.914940</td>
      <td>20.347241</td>
      <td>0.730463</td>
      <td>0.730463</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>2.440268</td>
      <td>1.820334</td>
      <td>14.184404</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.011340</td>
      <td>5.684507</td>
      <td>19.691553</td>
      <td>0.730463</td>
      <td>0.730463</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>2.440268</td>
      <td>1.820334</td>
      <td>14.047529</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.885846</td>
      <td>6.314735</td>
      <td>21.325160</td>
      <td>0.730463</td>
      <td>0.730463</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>2.602594</td>
      <td>1.820334</td>
      <td>14.182841</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 220 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="74">
<div class="sourceCode" id="cb100"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;SaleType&#39;</span> <span class="kw">in</span> train.columns:</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Cột &#39;SaleType&#39; tồn tại trong DataFrame &#39;train&#39;&quot;</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Cột &#39;SaleType&#39; không tồn tại trong DataFrame &#39;train&#39;&quot;</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<div class="output stream stdout">
<pre><code>Cột &#39;SaleType&#39; không tồn tại trong DataFrame &#39;train&#39;
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Ta thấy rõ ràng các cột phân loại đã được thay thế bằng các cột giá
trị nhị phân của các biến duy nhất trong các cột phân loại được chuyển
đổi</p>
</div>
<div class="cell code" data-execution_count="65">
<div class="sourceCode" id="cb102"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>test.head(<span class="dv">5</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="65">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MSSubClass</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandSlope</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>...</th>
      <th>SaleType_ConLw</th>
      <th>SaleType_New</th>
      <th>SaleType_Oth</th>
      <th>SaleType_WD</th>
      <th>SaleCondition_Abnorml</th>
      <th>SaleCondition_AdjLand</th>
      <th>SaleCondition_Alloca</th>
      <th>SaleCondition_Family</th>
      <th>SaleCondition_Normal</th>
      <th>SaleCondition_Partial</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1457</th>
      <td>2.055642</td>
      <td>6.221214</td>
      <td>20.479373</td>
      <td>0.730463</td>
      <td>0.730463</td>
      <td>1.540963</td>
      <td>0.0</td>
      <td>2.055642</td>
      <td>2.055642</td>
      <td>14.121376</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1458</th>
      <td>2.055642</td>
      <td>6.244956</td>
      <td>21.327220</td>
      <td>0.730463</td>
      <td>0.730463</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>2.259674</td>
      <td>2.055642</td>
      <td>14.116605</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1459</th>
      <td>2.885846</td>
      <td>6.073289</td>
      <td>21.196905</td>
      <td>0.730463</td>
      <td>0.730463</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>2.055642</td>
      <td>1.820334</td>
      <td>14.178149</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1460</th>
      <td>2.885846</td>
      <td>6.172972</td>
      <td>19.865444</td>
      <td>0.730463</td>
      <td>0.730463</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>2.259674</td>
      <td>2.055642</td>
      <td>14.179714</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1461</th>
      <td>0.000000</td>
      <td>5.093857</td>
      <td>17.257255</td>
      <td>0.730463</td>
      <td>0.730463</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>2.602594</td>
      <td>1.820334</td>
      <td>14.170316</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 220 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="67">
<div class="sourceCode" id="cb103"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>train[<span class="st">&#39;SaleType_ConLw&#39;</span>].head(<span class="dv">5</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="67">
<pre><code>0    0
1    0
2    0
3    0
4    0
Name: SaleType_ConLw, dtype: uint8</code></pre>
</div>
</div>
<section id="5-mô-hình" class="cell markdown">
<h1>5 Mô hình</h1>
</section>
<div class="cell code" data-execution_count="110">
<div class="sourceCode" id="cb105"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> ElasticNet, Lasso,  BayesianRidge, LassoLarsIC</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor,  GradientBoostingRegressor</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.kernel_ridge <span class="im">import</span> KernelRidge</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> RobustScaler</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> BaseEstimator, TransformerMixin, RegressorMixin, clone</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold, cross_val_score, train_test_split</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> lightgbm <span class="im">as</span> lgb</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.svm import SVR</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="co">#from catboost import CatBoostRegressor</span></span></code></pre></div>
</div>
<section id="51-hàm-kiểm-tra" class="cell markdown">
<h2>5.1 Hàm kiểm tra</h2>
</section>
<div class="cell markdown">
<p>Sử dụng cross_val_score với K-fold cross-validation để đánh giá hiệu
suất của mô hình trả về Root Mean Squared Logarithmic Error - RMSLE -
đánh giá sự khác biệt giữa các giá trị dự đoán và giá trị thực tế <img
src="https://www.includehelp.com/ml-ai/Images/rmse-1.jpg" alt="image" />
.RMSE có giá trị không âm và càng nhỏ càng tốt. Giá trị bằng 0 đạt được
khi các dự đoán hoàn toàn chính xác.</p>
</div>
<div class="cell code" data-execution_count="111">
<div class="sourceCode" id="cb106"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>n_folds <span class="op">=</span> <span class="dv">5</span> <span class="co"># Chia dữ liệu thành 5 phần (folds) để thực hiện K-fold cross-validation.</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sử dụng cross_val_scroe lấy ra neg_mean_squarred_error rồi trả về giá trị âm là mean squared error (MSE) rồi lấy square()</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co"># trả về 1 mảng các giá trị RMSLE (Root Mean Squared Logarithmic Error) cho từng lần lặp của quá trình cross-validation. </span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rmsle_cv(model):</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    kf <span class="op">=</span> KFold(n_folds, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>).get_n_splits(train.values)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> np.sqrt(<span class="op">-</span>cross_val_score(model, train.values, y_train, scoring<span class="op">=</span><span class="st">&quot;neg_mean_squared_error&quot;</span>, cv<span class="op">=</span>kf))</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(rmse)</span></code></pre></div>
</div>
<section id="52-xây-dựng-các-mô-hình" class="cell markdown">
<h2>5.2 Xây dựng các mô hình</h2>
</section>
<div class="cell markdown">
<ul>
<li>lasso: Sử dụng Lasso regression với RobustScaler để xử lý dữ liệu
trước khi hồi quy vì Mô hình này có thể rất nhạy cảm với các ngoại
lệ.</li>
<li>ENet: ElasticNet regression với RobustScaler.</li>
<li>KRR: Kernel Ridge Regression với kernel là hàm đa thức bậc 2.</li>
<li>GBoost: Gradient Boosting Regressor. #sử dụng hubber loss để xử lý
với các ngoại lệ</li>
<li>model_xgb: XGBoost Regressor.</li>
<li>model_lgb: LightGBM Regressor.</li>
</ul>
</div>
<div class="cell code" data-execution_count="103">
<div class="sourceCode" id="cb107"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> make_pipeline(RobustScaler(), Lasso(alpha<span class="op">=</span><span class="fl">0.0005</span>, random_state<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>ENet <span class="op">=</span> make_pipeline(RobustScaler(), ElasticNet(alpha<span class="op">=</span><span class="fl">0.0005</span>, l1_ratio<span class="op">=</span><span class="fl">.9</span>, random_state<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>KRR <span class="op">=</span> KernelRidge(alpha<span class="op">=</span><span class="fl">0.6</span>, kernel<span class="op">=</span><span class="st">&#39;polynomial&#39;</span>, degree<span class="op">=</span><span class="dv">2</span>, coef0<span class="op">=</span><span class="fl">2.5</span>)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>GBoost <span class="op">=</span> GradientBoostingRegressor(n_estimators<span class="op">=</span><span class="dv">3000</span>, learning_rate<span class="op">=</span><span class="fl">0.05</span>, max_depth<span class="op">=</span><span class="dv">4</span>, max_features<span class="op">=</span><span class="st">&#39;sqrt&#39;</span>,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>                                   min_samples_leaf<span class="op">=</span><span class="dv">15</span>, min_samples_split<span class="op">=</span><span class="dv">10</span>, loss<span class="op">=</span><span class="st">&#39;huber&#39;</span>, random_state<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>model_xgb <span class="op">=</span> xgb.XGBRegressor(colsample_bytree<span class="op">=</span><span class="fl">0.4603</span>, gamma<span class="op">=</span><span class="fl">0.0468</span>, learning_rate<span class="op">=</span><span class="fl">0.05</span>, max_depth<span class="op">=</span><span class="dv">3</span>, min_child_weight<span class="op">=</span><span class="fl">1.7817</span>,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>                             n_estimators<span class="op">=</span><span class="dv">2200</span>, reg_alpha<span class="op">=</span><span class="fl">0.4640</span>, reg_lambda<span class="op">=</span><span class="fl">0.8571</span>, subsample<span class="op">=</span><span class="fl">0.5213</span>, silent<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">7</span>, nthread<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>model_lgb <span class="op">=</span> lgb.LGBMRegressor(objective<span class="op">=</span><span class="st">&#39;regression&#39;</span>, num_leaves<span class="op">=</span><span class="dv">5</span>, learning_rate<span class="op">=</span><span class="fl">0.05</span>, n_estimators<span class="op">=</span><span class="dv">720</span>, max_bin<span class="op">=</span><span class="dv">55</span>, bagging_fraction<span class="op">=</span><span class="fl">0.8</span>, </span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>                              bagging_freq<span class="op">=</span><span class="dv">5</span>, feature_fraction<span class="op">=</span><span class="fl">0.2319</span>, feature_fraction_seed<span class="op">=</span><span class="dv">9</span>, bagging_seed<span class="op">=</span><span class="dv">9</span>, </span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>                              min_data_in_leaf<span class="op">=</span><span class="dv">6</span>, min_sum_hessian_in_leaf<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="co">#model_rf = RandomForestRegressor(n_estimators=1000, random_state=42)</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="co">#model_svr = make_pipeline(RobustScaler(), SVR(kernel=&#39;linear&#39;))</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="co">#model_cat = CatBoostRegressor(iterations=1000, learning_rate=0.05, depth=3, random_seed=42, silent=True)</span></span></code></pre></div>
</div>
<section id="53-đánh-giá-các-mô-hình" class="cell markdown">
<h2>5.3 Đánh giá các mô hình</h2>
<p>Điểm (RMSLE) trung bình của các mô hình trong quá trình chạy
cross-validation và độ lệch chuẩn</p>
</section>
<div class="cell code" data-execution_count="109">
<div class="sourceCode" id="cb108"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> rmsle_cv(lasso)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Lasso score: </span><span class="sc">{:.4f}</span><span class="st"> (</span><span class="sc">{:.4f}</span><span class="st">)</span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(score.mean(), score.std()))</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> rmsle_cv(ENet)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;ElasticNet score: </span><span class="sc">{:.4f}</span><span class="st"> (</span><span class="sc">{:.4f}</span><span class="st">)</span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(score.mean(), score.std()))</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> rmsle_cv(KRR)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Kernel Ridge score: </span><span class="sc">{:.4f}</span><span class="st"> (</span><span class="sc">{:.4f}</span><span class="st">)</span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(score.mean(), score.std()))</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> rmsle_cv(GBoost)</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Gradient Boosting score: </span><span class="sc">{:.4f}</span><span class="st"> (</span><span class="sc">{:.4f}</span><span class="st">)</span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(score.mean(), score.std()))</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> rmsle_cv(model_xgb)</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Xgboost score: </span><span class="sc">{:.4f}</span><span class="st"> (</span><span class="sc">{:.4f}</span><span class="st">)</span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(score.mean(), score.std()))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
Lasso score: 0.1114 (0.0072)

ElasticNet score: 0.1115 (0.0072)

Kernel Ridge score: 0.1151 (0.0072)

Gradient Boosting score: 0.1169 (0.0080)

Xgboost score: 0.1157 (0.0065)

</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="108">
<div class="sourceCode" id="cb110"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> rmsle_cv(model_lgb)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;LGBM score: </span><span class="sc">{:.4f}</span><span class="st"> (</span><span class="sc">{:.4f}</span><span class="st">)</span><span class="ch">\n</span><span class="st">&quot;</span> .<span class="bu">format</span>(score.mean(), score.std()))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0.000857 seconds.
You can set `force_row_wise=true` to remove the overhead.
And if memory is not enough, you can set `force_col_wise=true`.
[LightGBM] [Info] Total Bins 1441
[LightGBM] [Info] Number of data points in the train set: 1165, number of used features: 173
[LightGBM] [Info] Start training from score 12.020981
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0.000586 seconds.
You can set `force_row_wise=true` to remove the overhead.
And if memory is not enough, you can set `force_col_wise=true`.
[LightGBM] [Info] Total Bins 1453
[LightGBM] [Info] Number of data points in the train set: 1165, number of used features: 175
[LightGBM] [Info] Start training from score 12.022831
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0.000625 seconds.
You can set `force_row_wise=true` to remove the overhead.
And if memory is not enough, you can set `force_col_wise=true`.
[LightGBM] [Info] Total Bins 1442
[LightGBM] [Info] Number of data points in the train set: 1166, number of used features: 173
[LightGBM] [Info] Start training from score 12.020999
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0.000775 seconds.
You can set `force_row_wise=true` to remove the overhead.
And if memory is not enough, you can set `force_col_wise=true`.
[LightGBM] [Info] Total Bins 1455
[LightGBM] [Info] Number of data points in the train set: 1166, number of used features: 174
[LightGBM] [Info] Start training from score 12.032352
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0.000771 seconds.
You can set `force_row_wise=true` to remove the overhead.
And if memory is not enough, you can set `force_col_wise=true`.
[LightGBM] [Info] Total Bins 1449
[LightGBM] [Info] Number of data points in the train set: 1166, number of used features: 175
[LightGBM] [Info] Start training from score 12.021438
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
LGBM score: 0.1175 (0.0062)

</code></pre>
</div>
</div>
<section id="54-averaging-models-trung-bình-các-mô-hình-"
class="cell markdown">
<h2>5.4. Averaging Models (Trung bình các mô hình) </br></h2>
<ul>
<li>Tạo một lớp AveragingModels để trung bình dự đoán từ nhiều mô hình
cơ sở khác nhau.</li>
<li>Đánh giá hiệu suất của mô hình trung bình bằng hàm rmsle_cv.</li>
</ul>
</section>
<div class="cell code" data-execution_count="84">
<div class="sourceCode" id="cb113"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AveragingModels(BaseEstimator, RegressorMixin, TransformerMixin):</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, models):</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.models <span class="op">=</span> models</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#tạo các bản sao (clones) của các mô hình và huấn luyện từng mô hình với dữ liệu huấn luyện (X, y).    </span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y):</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.models_ <span class="op">=</span> [clone(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.models]</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> model <span class="kw">in</span> <span class="va">self</span>.models_:</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>            model.fit(X, y)</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dự đoán cho từng mô hình đã được huấn luyện và kết hợp các dự đoán bằng cách lấy trung bình các dự đoán đó.</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict(<span class="va">self</span>, X):</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">#kết hợp các dự đoán từ các mô hình thành một ma trận (mỗi cột là dự đoán từ một mô hình).</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>        predictions <span class="op">=</span> np.column_stack([model.predict(X) <span class="cf">for</span> model <span class="kw">in</span> <span class="va">self</span>.models_]) </span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># tính trung bình các dự đoán trên mỗi hàng (tức là trung bình các dự đoán từ các mô hình cho mỗi mẫu dữ liệu).</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.mean(predictions, axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a><span class="co">#ElasticNet , Gradient Boosting, Kernel Ridge Regression,lasso</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>averaged_models <span class="op">=</span> AveragingModels(models<span class="op">=</span>(ENet, GBoost, KRR, lasso))</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> rmsle_cv(averaged_models)</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Averaged base models score: </span><span class="sc">{:.4f}</span><span class="st"> (</span><span class="sc">{:.4f}</span><span class="st">)</span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(score.mean(), score.std()))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Averaged base models score: 0.1086 (0.0075)

</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Bằng cách kết hợp nhiều mô hình, chúng ta có thể giảm độ dao động của
các dự đoán và cải thiện độ ổn định của mô hình. Cách tiếp cận xếp chồng
đơn giản nhất cũng thực sự cải thiện được điểm số, ta sẽ thử tạo ra 1 mô
hình stacking mới</p>
</div>
<section id="55-stacking-model" class="cell markdown">
<h2>5.5 Stacking Model</h2>
<p><img src="http://i.imgur.com/QBuDOjs.jpg" alt="image" /> Stacking là
một phương pháp ensemble, trong đó nhiều mô hình cơ sở (base model) được
huấn luyện </br> Các dự đoán từ các mô hình cơ sở được sử dụng làm đầu
vào cho meta model để cải thiện độ chính xác của dự đoán.Meta model sau
đó học cách kết hợp các dự đoán này để tạo ra dự đoán cuối cùng.</p>
<ul>
<li>Tạo một lớp StackingAveragedModels để thực hiện stacking, kết hợp dự
đoán từ nhiều mô hình cơ sở (base models) và sử dụng một mô hình meta
(meta-model) để dự đoán cuối cùng</li>
<li>Đánh giá hiệu suất của mô hình trung bình bằng hàm rmsle_cv.</li>
</ul>
</section>
<div class="cell code" data-execution_count="86">
<div class="sourceCode" id="cb115"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#kế thừa từ BaseEstimator, RegressorMixin, và TransformerMixin của scikit-learn, hoạt động giống như một mô hình hồi quy chuẩn.</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StackingAveragedModels(BaseEstimator, RegressorMixin, TransformerMixin): </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, base_models, meta_model, n_folds<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.base_models <span class="op">=</span> base_models</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.meta_model <span class="op">=</span> meta_model</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n_folds <span class="op">=</span> n_folds</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y):</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.base_models_ <span class="op">=</span> [<span class="bu">list</span>() <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.base_models]</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.meta_model_ <span class="op">=</span> clone(<span class="va">self</span>.meta_model) </span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Sử dụng K-fold cross-validation để tạo ra các dự đoán &quot;out-of-fold&quot; từ các mô hình cơ sở.</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>        kfold <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="va">self</span>.n_folds, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">156</span>)</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>        out_of_fold_predictions <span class="op">=</span> np.zeros((X.shape[<span class="dv">0</span>], <span class="bu">len</span>(<span class="va">self</span>.base_models)))</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.base_models):</span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> train_index, holdout_index <span class="kw">in</span> kfold.split(X, y):</span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>                instance <span class="op">=</span> clone(model) <span class="co">#Tạo các bản sao (clones) của các mô hình cơ sở và huấn luyện chúng trên tập dữ liệu.</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.base_models_[i].append(instance)</span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>                instance.fit(X[train_index], y[train_index])</span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>                y_pred <span class="op">=</span> instance.predict(X[holdout_index])</span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>                out_of_fold_predictions[holdout_index, i] <span class="op">=</span> y_pred</span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.meta_model_.fit(out_of_fold_predictions, y)</span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict(<span class="va">self</span>, X):</span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Thực hiện dự đoán cho từng mô hình cơ sở và kết hợp các dự đoán đó.</span></span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>        meta_features <span class="op">=</span> np.column_stack([np.column_stack([model.predict(X) <span class="cf">for</span> model <span class="kw">in</span> base_models]).mean(axis<span class="op">=</span><span class="dv">1</span>) <span class="cf">for</span> base_models <span class="kw">in</span> <span class="va">self</span>.base_models_])</span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.meta_model_.predict(meta_features) <span class="co">#Sử dụng các dự đoán kết hợp làm đầu vào cho meta model để tạo ra dự đoán cuối cùng.</span></span>
<span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-32"><a href="#cb115-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-33"><a href="#cb115-33" aria-hidden="true" tabindex="-1"></a><span class="co">##ElasticNet , Gradient Boosting, Kernel Ridge Regression với meta_model là lasso</span></span>
<span id="cb115-34"><a href="#cb115-34" aria-hidden="true" tabindex="-1"></a>stacked_averaged_models <span class="op">=</span> StackingAveragedModels(base_models<span class="op">=</span>(ENet, GBoost, KRR), meta_model<span class="op">=</span>lasso)</span>
<span id="cb115-35"><a href="#cb115-35" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> rmsle_cv(stacked_averaged_models)</span>
<span id="cb115-36"><a href="#cb115-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Stacking Averaged models score: </span><span class="sc">{:.4f}</span><span class="st"> (</span><span class="sc">{:.4f}</span><span class="st">)&quot;</span>.<span class="bu">format</span>(score.mean(), score.std()))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Stacking Averaged models score: 0.1078 (0.0072)
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Ta thấy kết quả được cải thiện hơn khi ta bổ sung các meta
learner</p>
</div>
<section id="56-huấn-luyện-và-dự-đoán-các-mô-hình"
class="cell markdown">
<h2>5.6 Huấn luyện và dự đoán các mô hình</h2>
</section>
<section id="hàm-đánh-giá-kết-quả-dự-đoán" class="cell markdown">
<h3>Hàm đánh giá kết quả dự đoán</h3>
</section>
<div class="cell code" data-execution_count="96">
<div class="sourceCode" id="cb117"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score, mean_absolute_error, mean_squared_error</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rmsle(y, y_pred):</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.sqrt(mean_squared_error(y, y_pred))</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_model(y_true, y_pred):</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    rmsle_score <span class="op">=</span> np.sqrt(mean_squared_error(y_true, y_pred))</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>    mae <span class="op">=</span> mean_absolute_error(y_true, y_pred)</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> mean_squared_error(y_true, y_pred)</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;RMSLE: </span><span class="sc">{</span>rmsle_score<span class="sc">:.6f}</span><span class="ss">&quot;</span>)</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;R^2: </span><span class="sc">{</span>r2<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;MAE: </span><span class="sc">{</span>mae<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;MSE: </span><span class="sc">{</span>mse<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</div>
<section id="stackedregressor" class="cell markdown">
<h3>StackedRegressor:</h3>
</section>
<div class="cell code" data-execution_count="88">
<div class="sourceCode" id="cb118"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>stacked_averaged_models.fit(train.values, y_train)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>stacked_train_pred <span class="op">=</span> stacked_averaged_models.predict(train.values)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>stacked_pred <span class="op">=</span> np.expm1(stacked_averaged_models.predict(test.values))</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rmsle(y_train, stacked_train_pred))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>0.07906236934840372
</code></pre>
</div>
</div>
<section id="xgboost" class="cell markdown">
<h3>XGBoost</h3>
</section>
<div class="cell code" data-execution_count="89">
<div class="sourceCode" id="cb120"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>model_xgb.fit(train, y_train)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>xgb_train_pred <span class="op">=</span> model_xgb.predict(train)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>xgb_pred <span class="op">=</span> np.expm1(model_xgb.predict(test))</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rmsle(y_train, xgb_train_pred))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>0.08653209363874453
</code></pre>
</div>
</div>
<section id="lightgbm" class="cell markdown">
<h3>LightGBM</h3>
</section>
<div class="cell code" data-execution_count="90">
<div class="sourceCode" id="cb122"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>model_lgb.fit(train, y_train)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>lgb_train_pred <span class="op">=</span> model_lgb.predict(train)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>lgb_pred <span class="op">=</span> np.expm1(model_lgb.predict(test.values))</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rmsle(y_train, lgb_train_pred))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Warning] Found whitespace in feature_names, replace with underlines
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.001798 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 1485
[LightGBM] [Info] Number of data points in the train set: 1457, number of used features: 181
[LightGBM] [Info] Start training from score 12.023721
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
0.07201468347475141
</code></pre>
</div>
</div>
<section id="57-tạo-ra-dự-đoán-cuối-cùng-bằng-cách-kết-hợp"
class="cell markdown">
<h2>5.7 Tạo ra dự đoán cuối cùng bằng cách kết hợp</h2>
<p>Kết hợp các dự đoán từ các mô hình stacked_averaged_models,
model_xgb, và model_lgb với các trọng số tương ứng để tạo ra dự đoán
cuối cùng.</p>
</section>
<div class="cell markdown">
<p>Tìm ra các trọng số tối ưu cho từng mô hình trong một tập hợp các mô
hình (ensemble) để tối thiểu hóa RMSLE (Root Mean Squared Logarithmic
Error)</p>
</div>
<div class="cell code" data-execution_count="94">
<div class="sourceCode" id="cb124"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ensemble_predict(X_train, y_train, X_valid, y_valid, models):</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dự đoán dùng từng model</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>    pred1 <span class="op">=</span> models[<span class="dv">0</span>].predict(X_valid)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>    pred2 <span class="op">=</span> models[<span class="dv">1</span>].predict(X_valid)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    pred3 <span class="op">=</span> models[<span class="dv">2</span>].predict(X_valid)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#kết hợp các dự đoán từ các mô hình thành một ma trận (mỗi cột là dự đoán từ một mô hình).</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> np.column_stack((pred1, pred2, pred3))</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tính toán RMSLE</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rmsle_ensemble(weights):</span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>        final_pred <span class="op">=</span> np.<span class="bu">sum</span>(preds <span class="op">*</span> weights, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.sqrt(mean_squared_error(y_valid, final_pred)) <span class="co">#Tính RMSLE giữa giá trị thực tế (y_valid)  và giá trị dự đoán kết hợp (final_pred).</span></span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tìm ra các trọng số tốt nhất ( best weights)</span></span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb124-18"><a href="#cb124-18" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> np.ones(<span class="dv">3</span>) <span class="op">/</span> <span class="dv">3</span>  <span class="co"># Initial guess for the weights</span></span>
<span id="cb124-19"><a href="#cb124-19" aria-hidden="true" tabindex="-1"></a>    constraints <span class="op">=</span> ({<span class="st">&#39;type&#39;</span>: <span class="st">&#39;eq&#39;</span>, <span class="st">&#39;fun&#39;</span>: <span class="kw">lambda</span> w: <span class="dv">1</span> <span class="op">-</span> <span class="bu">sum</span>(w)}) <span class="co">#ràng buộc tổng các trọng số phải bằng 1.</span></span>
<span id="cb124-20"><a href="#cb124-20" aria-hidden="true" tabindex="-1"></a>    bounds <span class="op">=</span> [(<span class="dv">0</span>, <span class="dv">1</span>)] <span class="op">*</span> <span class="dv">3</span> <span class="co">#Giới hạn cho các trọng số, đảm bảo rằng mỗi trọng số nằm trong khoảng từ 0 đến 1.</span></span>
<span id="cb124-21"><a href="#cb124-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb124-22"><a href="#cb124-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Tìm các trọng số tốt nhất bằng cách sử dụng hàm tối thiểu hóa từ scipy để tìm các trọng số tốt nhất</span></span>
<span id="cb124-23"><a href="#cb124-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># method=&#39;SLSQP&#39; chỉ định phương pháp tối ưu sử dụng là Sequential Least Squares Programming</span></span>
<span id="cb124-24"><a href="#cb124-24" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> minimize(rmsle_ensemble, weights, method<span class="op">=</span><span class="st">&#39;SLSQP&#39;</span>, bounds<span class="op">=</span>bounds, constraints<span class="op">=</span>constraints)</span>
<span id="cb124-25"><a href="#cb124-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb124-26"><a href="#cb124-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result.x</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="97">
<div class="sourceCode" id="cb125"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [stacked_averaged_models, model_xgb, model_lgb]</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co">#ở đây ta dùng tập train để train và validation</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>best_weights <span class="op">=</span> ensemble_predict(train.values, y_train, train.values, y_train, models)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Best weights: </span><span class="sc">{</span>best_weights<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the best weights to make the final prediction</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>final_train_pred <span class="op">=</span> stacked_train_pred <span class="op">*</span> best_weights[<span class="dv">0</span>] <span class="op">+</span> xgb_train_pred <span class="op">*</span> best_weights[<span class="dv">1</span>] <span class="op">+</span> lgb_train_pred <span class="op">*</span> best_weights[<span class="dv">2</span>]</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  RMSLE</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Best RMSLE score on train data:&#39;</span>)</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a><span class="co">#print(rmsle(y_train, final_train_pred))</span></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>evaluate_model(y_train, final_train_pred)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[LightGBM] [Warning] min_data_in_leaf is set=6, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=6
[LightGBM] [Warning] feature_fraction is set=0.2319, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.2319
[LightGBM] [Warning] min_sum_hessian_in_leaf is set=11, min_child_weight=0.001 will be ignored. Current value: min_sum_hessian_in_leaf=11
[LightGBM] [Warning] bagging_fraction is set=0.8, subsample=1.0 will be ignored. Current value: bagging_fraction=0.8
[LightGBM] [Warning] bagging_freq is set=5, subsample_freq=0 will be ignored. Current value: bagging_freq=5
Best weights: [0.11577569 0.         0.88422431]
Best RMSLE score on train data:
RMSLE: 0.0719
R^2: 0.9676
MAE: 0.0507
MSE: 0.0052
</code></pre>
</div>
</div>
<div class="cell markdown">
<ul>
<li><p>RMSLE (Root Mean Squared Logarithmic Error): Đo lường sự khác
biệt giữa giá trị dự đoán và giá trị thực tế trên thang logarit. Giá trị
cho ra là thấp nhất trong các mô hình .</p></li>
<li><p>R^2 (Coefficient of Determination): Đo lường mức độ mà các biến
dự đoán giải thích được sự biến đổi của biến mục tiêu. Giá trị nằm trong
khoảng từ 0 đến 1, giá trị càng cao càng tốt.</p></li>
<li><p>MAE (Mean Absolute Error): Sai số trung bình giữa giá trị dự đoán
và giá trị thực tế. Giá trị thấp chứng tỏ mô hình dự đoán hiệu
quả.</p></li>
<li><p>MSE (Mean Squared Error): Đo lường trung bình bình phương sai số
giữa giá trị dự đoán và giá trị thực tế. Giá trị rất thấp cho thấy mô
hình dự đoán tốt.</p></li>
</ul>
</div>
<div class="cell code" data-execution_count="92">
<div class="sourceCode" id="cb127"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;RMSLE score on train data:&#39;</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rmsle(y_train, stacked_train_pred<span class="op">*</span><span class="fl">0.70</span> <span class="op">+</span> xgb_train_pred<span class="op">*</span><span class="fl">0.15</span> <span class="op">+</span> lgb_train_pred<span class="op">*</span><span class="fl">0.15</span>))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>RMSLE score on train data:
0.07699308045979378
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="115">
<div class="sourceCode" id="cb129"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>final_pred <span class="op">=</span> stacked_pred <span class="op">*</span> best_weights[<span class="dv">0</span>] <span class="op">+</span> xgb_pred <span class="op">*</span> best_weights[<span class="dv">1</span>] <span class="op">+</span> lgb_pred <span class="op">*</span> best_weights[<span class="dv">2</span>]</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>sub <span class="op">=</span> pd.DataFrame()</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>sub[<span class="st">&#39;Id&#39;</span>] <span class="op">=</span> test_ID</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>sub[<span class="st">&#39;SalePrice&#39;</span>] <span class="op">=</span> final_pred</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>sub.to_csv(<span class="st">&#39;submission.csv&#39;</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>sub.head(<span class="dv">5</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="115">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>SalePrice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1461</td>
      <td>123924.293078</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1462</td>
      <td>158926.724444</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1463</td>
      <td>186804.798750</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1464</td>
      <td>197695.090686</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1465</td>
      <td>189478.589619</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code">
<div class="sourceCode" id="cb130"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</body>
</html>
